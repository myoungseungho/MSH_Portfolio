<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>계단 오를 때 발이 공중에 안 뜨게 하는 법 - MSH Portfolio</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #fafafa;
            color: #333;
            line-height: 1.9;
        }
        .container { max-width: 800px; margin: 0 auto; padding: 60px 20px; }
        .back-link {
            display: inline-block;
            margin-bottom: 24px;
            color: #666;
            text-decoration: none;
        }
        .back-link:hover { color: #111; }
        .header { margin-bottom: 48px; }
        .header h1 { font-size: 2rem; font-weight: 700; color: #111; margin-bottom: 12px; }
        .header p { color: #666; font-size: 1.1rem; }

        .conversation {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin: 32px 0;
            border: 1px solid #e0e0e0;
        }
        .conversation h2 {
            font-size: 1.3rem;
            color: #1a237e;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e8eaf6;
        }

        .chat { margin-bottom: 20px; }
        .q {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 16px 20px;
            margin: 16px 0;
            border-radius: 0 12px 12px 0;
            font-weight: 500;
        }
        .q::before {
            content: "Q. ";
            color: #e65100;
            font-weight: 700;
        }
        .a {
            padding: 8px 0 8px 20px;
            border-left: 4px solid #e0e0e0;
            margin: 12px 0;
        }
        .a p { margin-bottom: 12px; }
        .a p:last-child { margin-bottom: 0; }

        .highlight {
            background: #e3f2fd;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: #1565c0;
        }
        .key-point {
            background: #c8e6c9;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: #2e7d32;
        }
        .warning {
            background: #ffcdd2;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: #c62828;
        }

        .code-block {
            background: #263238;
            color: #aed581;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 16px 0;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .code-block.visual {
            background: #f5f5f5;
            color: #333;
            border: 2px solid #e0e0e0;
            font-size: 1.2rem;
            line-height: 2;
            white-space: pre-wrap;
        }

        .diagram {
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            font-family: monospace;
            white-space: pre-wrap;
        }

        .compare-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .compare-table th, .compare-table td {
            border: 1px solid #e0e0e0;
            padding: 12px;
            text-align: left;
        }
        .compare-table th {
            background: #f5f5f5;
            font-weight: 600;
        }

        .summary-box {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 12px;
            padding: 24px;
            margin: 32px 0;
        }
        .summary-box h3 {
            color: #2e7d32;
            margin-bottom: 16px;
        }
        .summary-box ul {
            list-style: none;
            padding-left: 0;
        }
        .summary-box li {
            margin-bottom: 8px;
            padding-left: 24px;
            position: relative;
        }
        .summary-box li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #4caf50;
            font-weight: bold;
        }

        .analogy-box {
            background: #fff9c4;
            border-left: 4px solid #fbc02d;
            padding: 20px;
            margin: 24px 0;
            border-radius: 8px;
        }
        .analogy-box strong {
            color: #f57f17;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../index.html" class="back-link">← 홈으로</a>

        <div class="header">
            <h1>🦿 계단 오를 때 발이 공중에 안 뜨게 하는 법</h1>
            <p>IK (Inverse Kinematics) - 역운동학의 원리</p>
        </div>

        <!-- 1. 문제 상황 -->
        <div class="conversation">
            <h2>1. 뭐가 문제야?</h2>

            <div class="chat">
                <div class="q">캐릭터가 계단 오를 때 발이 공중에 뜨면 어떻게 보여?</div>
                <div class="a">
                    <div class="code-block visual">❌ 문제 상황:

계단: ▀▀▀
        ▀▀▀
캐릭터: 🚶
        👟💨 ← 발이 공중에!

→ 완전 어색함. 마치 공중부양하는 것 같음.</div>
                    <p><span class="warning">평지 걷기 애니메이션을 그대로 재생하면 이렇게 돼.</span></p>
                </div>
            </div>

            <div class="chat">
                <div class="q">현실에서는?</div>
                <div class="a">
                    <p><span class="key-point">발이 계단에 딱 붙잖아.</span></p>
                    <div class="code-block visual">✅ 현실:

계단: ▀▀▀
        ▀▀▀👟 ← 발이 계단에 딱!
캐릭터: 🚶</div>
                    <p><strong>게임에서도 이렇게 해야 자연스러워.</strong></p>
                </div>
            </div>
        </div>

        <!-- 2. 기존 방식 (FK) -->
        <div class="conversation">
            <h2>2. 기존 방식: Forward Kinematics (FK)</h2>

            <div class="chat">
                <div class="q">원래는 어떻게 애니메이션을 재생해?</div>
                <div class="a">
                    <p><strong>부모 뼈대에서 자식 뼈대로 순서대로 계산해.</strong></p>
                    <div class="analogy-box">
                        <strong>🚂 비유: 기차</strong><br><br>
                        기관차(어깨)를 30도 돌리면<br>
                        → 1번 칸(팔꿈치)이 따라서 움직임<br>
                        → 2번 칸(손목)이 따라서 움직임<br>
                        → 3번 칸(손)이 따라서 움직임<br><br>
                        <span class="key-point">부모가 움직이면 자식이 자동으로 따라가!</span>
                    </div>
                    <div class="diagram">어깨 (회전 30도)  ← 여기만 지정!
  ↓
팔꿈치 (회전 -45도)  ← 여기만 지정!
  ↓
손목 (회전 10도)  ← 여기만 지정!
  ↓
손 위치 = ??? (자동 계산됨)  ← 이건 몰라!</div>
                    <p>이걸 <span class="highlight">Forward Kinematics (FK)</span>라고 해.</p>
                    <p><strong>순방향 운동학</strong> = 각도만 정하면 → 최종 위치는 자동으로 나옴</p>
                </div>
            </div>

            <div class="chat">
                <div class="q">코드로 보면?</div>
                <div class="a">
                    <div class="code-block">// FK: 부모에서 자식으로
shoulder->rotation = 30도;
elbow->rotation = -45도;
wrist->rotation = 10도;

// 손 위치는 자동으로 계산됨
hand->position = CalculateFromParent(shoulder, elbow, wrist);</div>
                </div>
            </div>

            <div class="chat">
                <div class="q">FK의 문제점은?</div>
                <div class="a">
                    <p><span class="warning">손 위치를 직접 지정할 수 없어!</span></p>
                    <div class="analogy-box">
                        <strong>☕ 비유: 책상 위 컵 잡기</strong><br><br>
                        <strong>FK 방식:</strong><br>
                        "어깨를 30도 들고, 팔꿈치를 45도 굽혀"<br>
                        → 실행!<br>
                        → 어? 손이 컵 옆에 있네? 못 잡았어!<br>
                        → 다시... "어깨를 35도? 팔꿈치를 50도?"<br>
                        → 또 실패... 계속 시행착오 😰<br><br>

                        <strong>IK 방식:</strong><br>
                        "손을 컵 위치에 놓아!"<br>
                        → 알아서 어깨, 팔꿈치 각도가 계산됨<br>
                        → 바로 컵을 잡음! ✅
                    </div>
                    <p><strong>핵심 차이:</strong></p>
                    <div class="code-block">FK: 각도를 알려줌 → 결과 위치를 모름
- "무릎을 45도 굽혀"
- 발이 어디 있을지? ❓
- 계단에 안 맞을 수도 있음 ❌

IK: 목표 위치를 알려줌 → 각도가 자동 계산됨
- "발을 계단 위(좌표 50, 20)에 놓아"
- 무릎이 알아서 적절히 굽혀짐 ✅
- 정확히 계단에 딱 맞음!</div>
                    <p><span class="key-point">FK는 "과정"을 지정하고, IK는 "결과"를 지정해!</span></p>
                </div>
            </div>
        </div>

        <!-- 3. IK 개념 -->
        <div class="conversation">
            <h2>3. IK (Inverse Kinematics)는 뭐야?</h2>

            <div class="chat">
                <div class="q">Inverse는 "역"이라는 뜻인데...</div>
                <div class="a">
                    <p><span class="key-point">FK의 반대로 계산하는 거야!</span></p>
                    <table class="compare-table">
                        <tr>
                            <th>방식</th>
                            <th>순서</th>
                            <th>특징</th>
                        </tr>
                        <tr>
                            <td><strong>FK<br>(Forward Kinematics)</strong></td>
                            <td>어깨 각도 → 팔꿈치 각도 → 손 위치</td>
                            <td>각도를 주면 위치가 계산됨</td>
                        </tr>
                        <tr>
                            <td><strong>IK<br>(Inverse Kinematics)</strong></td>
                            <td>손 위치 → 팔꿈치 각도 → 어깨 각도</td>
                            <td>위치를 주면 각도가 계산됨</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="chat">
                <div class="q">구체적으로 어떻게 "역으로" 계산해?</div>
                <div class="a">
                    <p><strong>예시: 팔 두 개 관절 (어깨-팔꿈치-손)</strong></p>
                    <div class="diagram">목표: 손을 여기에! 👆 (x, y, z)
         ↓
   어떻게 하면 닿을까?
         ↓
   팔꿈치를 몇 도 굽혀야 해?
         ↓
   어깨를 몇 도 돌려야 해?
         ↓
   계산 완료! ✅</div>
                </div>
            </div>
        </div>

        <!-- 4. IK 원리 (간단한 2-Joint) -->
        <div class="conversation">
            <h2>4. IK 원리: 2개 관절은 어떻게 계산해?</h2>

            <div class="chat">
                <div class="q">가장 간단한 경우부터 보자. 다리(골반-무릎-발)는 어떻게?</div>
                <div class="a">
                    <p><strong>주어진 것:</strong></p>
                    <div class="code-block">- 골반 위치: (0, 100, 0)
- 발 목표 위치: (50, 20, 0)  ← 계단 위치
- 허벅지 길이: 40cm
- 종아리 길이: 40cm</div>

                    <p><strong>구해야 할 것:</strong></p>
                    <div class="code-block">- 무릎 각도 = ???
- 골반 회전 각도 = ???</div>
                </div>
            </div>

            <div class="chat">
                <div class="q">수학적으로 어떻게 풀어?</div>
                <div class="a">
                    <p><strong>1단계: 골반에서 발까지 거리 계산</strong></p>
                    <div class="code-block">distance = sqrt((50-0)² + (20-100)² + (0-0)²)
         = sqrt(2500 + 6400)
         = sqrt(8900)
         = 94.3cm</div>

                    <p><strong>2단계: 무릎 각도 계산 (코사인 법칙)</strong></p>
                    <div class="code-block">// 코사인 법칙: c² = a² + b² - 2ab·cos(C)
// a = 허벅지(40), b = 종아리(40), c = 거리(94.3)

cos(무릎각) = (40² + 40² - 94.3²) / (2 × 40 × 40)
           = (1600 + 1600 - 8892) / 3200
           = -5692 / 3200
           = ...

무릎 각도 = acos(...)</div>

                    <p><span class="warning">수학이 복잡하지?</span> <strong>하지만 개념은 간단해:</strong></p>
                    <div class="code-block visual">골반에서 발까지 거리 알면
   ↓
삼각형을 만들 수 있고
   ↓
삼각형 각도를 계산 (삼각함수)
   ↓
무릎 각도 나옴!</div>
                </div>
            </div>

            <div class="chat">
                <div class="q">직접 수학 풀어야 해?</div>
                <div class="a">
                    <p><span class="key-point">아니! 게임 엔진이 다 해줘.</span></p>
                    <div class="code-block">// Unity 예시
IKTarget footIK;
footIK.targetPosition = stairPosition;  // 계단 위치
animator.SetIKPosition(AvatarIKGoal.LeftFoot, footIK.targetPosition);

// → 엔진이 자동으로 무릎/골반 각도 계산!</div>
                </div>
            </div>
        </div>

        <!-- 5. 실전 코드 -->
        <div class="conversation">
            <h2>5. 실제 코드는 어떻게 생겼어?</h2>

            <div class="chat">
                <div class="q">C++로 간단한 2-Joint IK 직접 구현하면?</div>
                <div class="a">
                    <div class="code-block">struct Joint {
    Vector3 position;
    float rotation;
    float length;  // 뼈 길이
};

// 2-Joint IK (다리: 골반-무릎-발)
void SolveTwoJointIK(
    Joint* hip,        // 골반
    Joint* knee,       // 무릎
    Joint* foot,       // 발
    Vector3 targetPos  // 발 목표 위치
) {
    // 1. 골반→목표 거리
    Vector3 toTarget = targetPos - hip->position;
    float distance = toTarget.Length();

    // 2. 최대 거리 체크 (다리를 쭉 뻗어도 안 닿으면?)
    float maxReach = hip->length + knee->length;
    if (distance > maxReach) {
        distance = maxReach;  // 최대한 뻗기
    }

    // 3. 무릎 각도 계산 (코사인 법칙)
    float hipLen = hip->length;
    float kneeLen = knee->length;

    float cosAngle = (hipLen*hipLen + kneeLen*kneeLen - distance*distance)
                   / (2 * hipLen * kneeLen);

    knee->rotation = acos(cosAngle);

    // 4. 골반 회전 계산
    float targetAngle = atan2(toTarget.y, toTarget.x);
    float adjustment = asin(kneeLen * sin(knee->rotation) / distance);

    hip->rotation = targetAngle - adjustment;

    // 5. 최종 위치 업데이트
    knee->position = hip->position +
        Vector3(cos(hip->rotation), sin(hip->rotation)) * hipLen;

    foot->position = knee->position +
        Vector3(cos(hip->rotation + knee->rotation),
                sin(hip->rotation + knee->rotation)) * kneeLen;
}</div>
                </div>
            </div>

            <div class="chat">
                <div class="q">게임 엔진에서는?</div>
                <div class="a">
                    <p><strong>Unity:</strong></p>
                    <div class="code-block">void OnAnimatorIK(int layerIndex) {
    // 계단 위치 찾기
    RaycastHit hit;
    if (Physics.Raycast(leftFoot.position, Vector3.down, out hit)) {
        // 발을 계단에 맞춤
        animator.SetIKPositionWeight(AvatarIKGoal.LeftFoot, 1.0f);
        animator.SetIKPosition(AvatarIKGoal.LeftFoot, hit.point);

        // 발 회전도 맞춤
        animator.SetIKRotationWeight(AvatarIKGoal.LeftFoot, 1.0f);
        animator.SetIKRotation(AvatarIKGoal.LeftFoot,
            Quaternion.LookRotation(transform.forward, hit.normal));
    }
}</div>

                    <p><strong>Unreal Engine (C++):</strong></p>
                    <div class="code-block">// Animation Blueprint에서
FIKChain LeftLegIK;
LeftLegIK.EffectorLocation = StairPosition;  // 계단 위치
LeftLegIK.JointTarget = KneeHintPosition;    // 무릎이 향할 방향

// IK 적용
UAnimInstance->SetIKTarget("LeftFoot", LeftLegIK);</div>
                </div>
            </div>
        </div>

        <!-- 6. 게임 사용 사례 -->
        <div class="conversation">
            <h2>6. 게임에서 어디에 쓰여?</h2>

            <div class="chat">
                <div class="q">계단 말고 다른 곳은?</div>
                <div class="a">
                    <table class="compare-table">
                        <tr>
                            <th>상황</th>
                            <th>IK 사용</th>
                            <th>효과</th>
                        </tr>
                        <tr>
                            <td><strong>경사면 걷기</strong></td>
                            <td>발을 지면에 맞춤</td>
                            <td>발이 땅에 파묻히거나 뜨지 않음</td>
                        </tr>
                        <tr>
                            <td><strong>문손잡이 잡기</strong></td>
                            <td>손을 손잡이에 맞춤</td>
                            <td>캐릭터가 정확히 잡는 것처럼 보임</td>
                        </tr>
                        <tr>
                            <td><strong>총 겨누기</strong></td>
                            <td>손을 타겟에 향하게</td>
                            <td>정확한 조준 자세</td>
                        </tr>
                        <tr>
                            <td><strong>사다리 오르기</strong></td>
                            <td>손/발을 사다리 칸에 맞춤</td>
                            <td>자연스러운 오르기</td>
                        </tr>
                        <tr>
                            <td><strong>VR 손 추적</strong></td>
                            <td>손 위치에서 팔 전체 계산</td>
                            <td>실제 손 위치에 맞게 팔 움직임</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- 7. 제약 조건 -->
        <div class="conversation">
            <h2>7. 제약 조건 (Constraints)은 뭐야?</h2>

            <div class="chat">
                <div class="q">무릎이 앞으로도 굽혀지면 이상하잖아?</div>
                <div class="a">
                    <p><span class="key-point">정확해!</span> 그래서 <strong>제약 조건</strong>을 걸어야 해.</p>
                    <div class="code-block visual">❌ 제약 없으면:
    /\
   /  \  무릎이 이상한 방향으로 굽혀짐
  /    \

✅ 제약 있으면:
  \
   \ >  무릎이 뒤로만 굽혀짐 (자연스러움)
    \</div>
                </div>
            </div>

            <div class="chat">
                <div class="q">코드로는 어떻게?</div>
                <div class="a">
                    <div class="code-block">// 무릎 각도 제약
knee->rotation = acos(cosAngle);

// 제약: 무릎은 0도 ~ 170도만 가능
if (knee->rotation < 0)
    knee->rotation = 0;
if (knee->rotation > 170도)
    knee->rotation = 170도;

// Pole Vector (힌트): 무릎이 향할 방향 지정
Vector3 kneeHint = Vector3(0, 0, 1);  // 앞쪽으로</div>
                </div>
            </div>

            <div class="chat">
                <div class="q">Pole Vector가 뭐야?</div>
                <div class="a">
                    <p><strong>문제 상황:</strong></p>
                    <div class="code-block visual">손 위치가 여기! 👆
     |
  어깨

무릎이 이쪽? ← 또는 이쪽? →</div>

                    <p>손 위치만 주면 <span class="warning">무릎이 어느 방향으로 굽혀질지 모호해.</span></p>
                    <p><strong>Pole Vector = "무릎은 이 방향으로 굽혀!"</strong> 힌트를 주는 거야.</p>
                    <div class="code-block">poleVector = Vector3(0, 0, 1);  // 앞쪽

// IK가 이 방향을 참고해서 무릎 각도 계산</div>
                </div>
            </div>
        </div>

        <!-- 8. FK vs IK 비교 -->
        <div class="conversation">
            <h2>8. 그럼 IK가 무조건 좋아?</h2>

            <div class="chat">
                <div class="q">FK는 이제 안 써?</div>
                <div class="a">
                    <p><span class="warning">아니! 둘 다 써.</span></p>
                    <table class="compare-table">
                        <tr>
                            <th>방식</th>
                            <th>장점</th>
                            <th>단점</th>
                            <th>사용 예</th>
                        </tr>
                        <tr>
                            <td><strong>FK</strong></td>
                            <td>- 빠름<br>- 자연스러운 동작<br>- 애니메이터 제어</td>
                            <td>- 위치 지정 불가<br>- 환경 적응 어려움</td>
                            <td>- 기본 걷기/뛰기<br>- 공격 모션<br>- 춤</td>
                        </tr>
                        <tr>
                            <td><strong>IK</strong></td>
                            <td>- 정확한 위치<br>- 환경 적응<br>- 물체 상호작용</td>
                            <td>- 느림 (계산량)<br>- 부자연스러울 수 있음</td>
                            <td>- 계단/경사면<br>- 물건 잡기<br>- VR</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="chat">
                <div class="q">실제로는 어떻게 섞어 써?</div>
                <div class="a">
                    <div class="code-block">// 1. FK로 기본 걷기 애니메이션 재생
animator.Play("Walk");

// 2. IK로 발만 지면에 맞춤
void OnAnimatorIK() {
    // FK 애니메이션은 그대로
    // 발 위치만 IK로 보정
    if (Physics.Raycast(foot.position, Vector3.down, out hit)) {
        animator.SetIKPosition(AvatarIKGoal.LeftFoot, hit.point);
    }
}

// → FK(자연스러움) + IK(정확성) 조합!</div>
                </div>
            </div>
        </div>

        <!-- 9. 핵심 정리 -->
        <div class="summary-box">
            <h3>📌 핵심 정리: IK (Inverse Kinematics)</h3>
            <ul>
                <li><strong>IK란?</strong> - 목표 위치를 정하면 관절 각도가 자동으로 계산되는 것 (역운동학)</li>
                <li><strong>FK와의 차이</strong> - FK는 각도→위치, IK는 위치→각도</li>
                <li><strong>왜 필요?</strong> - 계단, 경사면, 물건 잡기 등 환경에 정확히 맞춰야 할 때</li>
                <li><strong>원리</strong> - 삼각함수, 코사인 법칙으로 관절 각도 역계산</li>
                <li><strong>2-Joint IK</strong> - 가장 간단한 형태 (골반-무릎-발)</li>
                <li><strong>제약 조건</strong> - 무릎이 이상한 방향으로 안 굽히게 각도 제한</li>
                <li><strong>Pole Vector</strong> - 관절이 굽혀질 방향 힌트</li>
                <li><strong>실전</strong> - FK(기본 동작) + IK(보정) 조합해서 사용</li>
            </ul>
        </div>

        <!-- 10. 실제 게임 사례 -->
        <div class="conversation">
            <h2>🎮 실제 게임 사례</h2>

            <div class="chat">
                <div class="q">어떤 게임이 IK를 잘 써?</div>
                <div class="a">
                    <p><strong>언차티드 / The Last of Us (Naughty Dog)</strong></p>
                    <div class="code-block">- 경사면/계단에서 발이 지면에 딱 붙음
- 벽에 손 짚을 때 정확한 위치
- 극도로 자연스러운 이동</div>

                    <p><strong>Red Dead Redemption 2 (Rockstar)</strong></p>
                    <div class="code-block">- 말 타고 경사면 이동 시 발 위치
- 문손잡이, 레버 등 상호작용
- 지형에 따라 자세 자동 조정</div>

                    <p><strong>Half-Life: Alyx (VR)</strong></p>
                    <div class="code-block">- VR 컨트롤러 손 위치 → 팔 전체 IK
- 물건 집을 때 정확한 그립
- 실시간 손-팔 동기화</div>
                </div>
            </div>
        </div>

    </div>
</body>
</html>