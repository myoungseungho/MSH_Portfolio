<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lag Compensation: 네트워크 지연 보상 - MSH Portfolio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #fafafa;
            color: #333;
            line-height: 1.8;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 60px 20px;
        }

        .nav {
            margin-bottom: 40px;
        }

        .nav a {
            color: #666;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .nav a:hover {
            color: #333;
        }

        .header {
            margin-bottom: 50px;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: #111;
        }

        .header-meta {
            display: flex;
            gap: 20px;
            color: #666;
            font-size: 0.9rem;
        }

        .section {
            margin-bottom: 50px;
        }

        .section h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #111;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .section h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 30px 0 15px 0;
            color: #333;
        }

        .section p {
            margin-bottom: 16px;
            color: #444;
        }

        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
        }

        pre code {
            background: none;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        th, td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f8f8;
            font-weight: 600;
            color: #333;
        }

        tr:last-child td {
            border-bottom: none;
        }

        .question-box {
            background: #fff8e1;
            border-left: 4px solid #ff9800;
            padding: 20px;
            border-radius: 0 8px 8px 0;
            margin: 20px 0;
        }

        .question-box h4 {
            color: #e65100;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .question-box p {
            margin-bottom: 0;
            color: #5d4037;
        }

        .answer-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 20px;
            border-radius: 0 8px 8px 0;
            margin: 20px 0;
        }

        .answer-box h4 {
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .answer-box p {
            margin-bottom: 0;
            color: #1b5e20;
        }

        .insight-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            border-radius: 0 8px 8px 0;
            margin: 20px 0;
        }

        .insight-box h4 {
            color: #1565c0;
            margin-bottom: 10px;
        }

        .insight-box p {
            color: #0d47a1;
            margin-bottom: 8px;
        }

        .insight-box p:last-child {
            margin-bottom: 0;
        }

        .problem-box {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 20px;
            border-radius: 0 8px 8px 0;
            margin: 20px 0;
        }

        .problem-box h4 {
            color: #c62828;
            margin-bottom: 10px;
        }

        .problem-box p {
            color: #b71c1c;
            margin-bottom: 0;
        }

        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 20px;
            border-radius: 0 8px 8px 0;
            margin: 20px 0;
        }

        .warning-box h4 {
            color: #e65100;
            margin-bottom: 10px;
        }

        .warning-box p {
            color: #bf360c;
            margin-bottom: 0;
        }

        ul, ol {
            margin: 16px 0;
            padding-left: 24px;
        }

        li {
            margin-bottom: 8px;
        }

        .diagram {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 24px;
            margin: 20px 0;
            font-family: 'Consolas', monospace;
            white-space: pre;
            overflow-x: auto;
            line-height: 1.4;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 20px 0;
        }

        .tag {
            background: #e8f4fd;
            color: #1976d2;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .footer {
            text-align: center;
            padding: 40px 0;
            color: #999;
            font-size: 0.9rem;
            border-top: 1px solid #e0e0e0;
            margin-top: 60px;
        }

        .summary-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
        }

        .summary-box h3 {
            color: white;
            margin-top: 0;
            font-size: 1.3rem;
        }

        .summary-box p {
            color: rgba(255,255,255,0.9);
            margin-bottom: 12px;
        }

        .summary-box code {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .demo-gif {
            width: 100%;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .comparison-table {
            margin: 30px 0;
        }

        .comparison-table th {
            text-align: center;
        }

        .comparison-table td {
            text-align: center;
        }

        .comparison-table td:first-child {
            text-align: left;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <a href="../../">&larr; 돌아가기</a>
        </nav>

        <header class="header">
            <h1>Lag Compensation: 네트워크 지연 보상</h1>
            <div class="header-meta">
                <span>게임 네트워크 프로그래밍</span>
                <span>2025.01</span>
            </div>
            <div class="tags">
                <span class="tag">Client Prediction</span>
                <span class="tag">Server Reconciliation</span>
                <span class="tag">Interpolation</span>
                <span class="tag">Lag Compensation</span>
                <span class="tag">FPS</span>
            </div>
        </header>

        <!-- 개요 -->
        <section class="section">
            <h2>개요</h2>
            <p>
                온라인 게임을 할 때 "렉 걸린다", "핑이 높다"는 말을 많이 하죠.
                하지만 실제로 게임은 어떻게 이 지연을 처리하고, 왜 가끔 벽 뒤에서 죽는 걸까요?
            </p>
            <p>
                이 문서는 네트워크 지연이 무엇인지부터 시작해서, 게임이 이를 어떻게 극복하는지
                <strong>질문과 답변 형식</strong>으로 차근차근 알아봅니다.
            </p>
        </section>

        <!-- 1. 네트워크 지연이란? -->
        <section class="section">
            <h2>1. 네트워크 지연이란?</h2>

            <div class="question-box">
                <h4>질문</h4>
                <p>온라인 게임에서 내가 키보드로 "앞으로 이동" 키를 눌렀어. 서버는 서울에 있고 나는 부산에서 접속했다면, 이 입력이 서버에 도착하려면 어떤 과정을 거칠까?</p>
            </div>

            <div class="answer-box">
                <h4>답</h4>
                <p>네트워크를 통해서 몇 ms 걸리지 않을까?</p>
            </div>

            <p>맞습니다. 서울-부산이면 약 <code>10~30ms</code>, 해외 서버면 <code>100~200ms</code>도 걸려요.</p>

            <p>그런데 생각해보세요:</p>

            <div class="diagram">1. 내가 "앞으로" 키를 누름
2. 입력이 서버로 감 (30ms)
3. 서버가 캐릭터 이동 처리
4. 서버가 "캐릭터 위치 변경됨" 결과를 나에게 보냄 (30ms)</div>

            <div class="problem-box">
                <h4>문제</h4>
                <p><strong>왕복 60ms</strong> 후에야 내 화면에서 캐릭터가 움직여요. 키 누르고 0.06초 후에 움직이면 플레이어 입장에서 어떤 느낌일까요?</p>
            </div>

            <div class="answer-box">
                <h4>답</h4>
                <p>약간 답답하고 렉 걸리는 느낌?</p>
            </div>

            <p>정확해요! 60ms도 답답한데, 해외 서버 200ms면 키 누르고 0.2초 후에 움직여요. 거의 게임 불가 수준이죠.</p>

            <div class="question-box">
                <h4>질문</h4>
                <p>근데 실제로 배틀그라운드나 롤 같은 게임, 해외 서버 접속해도 <strong>내 캐릭터는 키 누르자마자 바로 움직이잖아?</strong> 어떻게 그게 가능할까?</p>
            </div>
        </section>

        <!-- 2. 클라이언트 예측 -->
        <section class="section">
            <h2>2. 클라이언트 예측 (Client-side Prediction)</h2>

            <div class="answer-box">
                <h4>답</h4>
                <p>클라이언트가 먼저 움직이고 서버한테 알려주는 방식?</p>
            </div>

            <p>정확합니다! 이게 바로 <strong>"클라이언트 예측 (Client-side Prediction)"</strong>이에요.</p>

            <div class="insight-box">
                <h4>클라이언트 예측 핵심</h4>
                <p>서버 응답 기다리지 말고, 클라이언트가 "나 이렇게 움직일 거야"라고 <strong>먼저 예측해서 화면에 보여주는 것</strong>.</p>
                <p>그래서 키 누르면 바로 움직이는 것처럼 느껴지죠!</p>
            </div>

            <img src="step1.gif" alt="Client Prediction 비교" class="demo-gif">
            <p style="text-align: center; color: #666; font-size: 0.9rem;">
                왼쪽(OFF): 서버 응답 기다림 - 답답함 / 오른쪽(ON): 즉시 반응 - 부드러움
            </p>
        </section>

        <!-- 3. 서버 재조정 -->
        <section class="section">
            <h2>3. 서버 재조정과 러버밴딩</h2>

            <div class="question-box">
                <h4>질문</h4>
                <p>클라이언트가 "앞으로 이동"했어. 근데 서버에서 확인해보니까 그 타이밍에 나는 적한테 맞아서 기절 상태였어. 클라이언트는 이미 캐릭터를 앞으로 움직여서 보여줬는데, 서버는 "아니, 너 못 움직여"라고 해. 어떻게 처리해야 할까?</p>
            </div>

            <div class="answer-box">
                <h4>답</h4>
                <p>서버 결과로 되돌려야 하지 않을까?</p>
            </div>

            <p>맞아요! 이게 <strong>"서버 재조정 (Server Reconciliation)"</strong> 또는 <strong>"롤백"</strong>이에요.</p>

            <div class="insight-box">
                <h4>핵심 원칙: 서버가 절대 권위 (Server Authority)</h4>
                <p>클라이언트가 뭘 보여줬든, <strong>서버 결과가 "진짜"</strong>입니다.</p>
                <p>클라이언트 예측이 틀렸으면? → 서버 상태로 <strong>강제로 되돌림</strong></p>
            </div>

            <div class="question-box">
                <h4>질문</h4>
                <p>이게 플레이어 눈에 어떻게 보일까?</p>
            </div>

            <div class="answer-box">
                <h4>답</h4>
                <p>좋은 품질의 게임일수록 내가 '안 움직였는데' 갑자기 서버에 의해 강제적으로 돌아가는 건 썩 불쾌한 경험일 것 같은데...</p>
            </div>

            <p>정확해요. 캐릭터가 앞으로 갔다가 갑자기 <strong>"휙"</strong> 하고 원래 위치로 튕겨져 돌아오는 거예요. 이걸 <strong>"러버밴딩 (Rubber-banding)"</strong>이라고 해요. 고무줄처럼 튕겨 돌아오는 현상이죠.</p>

            <img src="step2.gif" alt="Rubberbanding 데모" class="demo-gif">
            <p style="text-align: center; color: #666; font-size: 0.9rem;">
                클라이언트가 벽을 통과하려 하면, 서버가 거부하고 롤백 발생
            </p>

            <p>좋은 게임일수록 이게 안 느껴져야 해요:</p>
            <ul>
                <li>클라이언트와 서버가 <strong>똑같은 게임 로직</strong> 사용</li>
                <li>예측이 거의 안 틀리게 만듦</li>
                <li>롤백이 필요해도 <strong>부드럽게</strong> 보정 (갑자기 텔레포트 X)</li>
            </ul>
        </section>

        <!-- 4. 보간 -->
        <section class="section">
            <h2>4. 다른 플레이어는 어떻게 보일까?</h2>

            <p>여기까지는 <strong>"내 캐릭터"</strong> 얘기였어요. 근데 온라인 게임엔 <strong>다른 플레이어</strong>도 있잖아요.</p>

            <div class="question-box">
                <h4>질문</h4>
                <p>상대방 캐릭터 위치 정보는 어디서 오나요? 그리고 그 정보도 네트워크 지연이 있을 텐데... 다른 플레이어는 내 화면에서 어떻게 보일까?</p>
            </div>

            <div class="answer-box">
                <h4>답</h4>
                <p>끊기거나 뚝뚝 끊겨 보이지 않을까?</p>
            </div>

            <p>맞아요. 서버가 초당 30번(30틱) 위치를 보내면, 그 사이사이는 <strong>정보가 없어서</strong> 뚝뚝 끊겨 보여요.</p>

            <div class="insight-box">
                <h4>보간 (Interpolation)</h4>
                <p>위치 A에서 위치 B로 갈 때, 그 <strong>사이를 부드럽게 이어주는 것</strong>.</p>
            </div>

            <div class="diagram">받은 정보:  A -------- B -------- C
보간 적용:  A ~ ~ ~ ~ B ~ ~ ~ ~ C  (부드럽게 채움)</div>

            <img src="step3.gif" alt="Interpolation 비교" class="demo-gif">
            <p style="text-align: center; color: #666; font-size: 0.9rem;">
                왼쪽(OFF): 뚝뚝 순간이동 / 오른쪽(ON): 부드럽게 이동
            </p>
        </section>

        <!-- 5. Lag Compensation -->
        <section class="section">
            <h2>5. 총은 맞은 거야, 빗나간 거야?</h2>

            <p>이제 진짜 <strong>제일 어려운 문제</strong>예요.</p>

            <div class="question-box">
                <h4>상황</h4>
                <p>FPS 게임이야. 내가 적을 조준해서 총을 쐈어. <strong>내 화면에서는 분명히 맞았어.</strong></p>
                <p>근데 생각해봐:</p>
                <ul>
                    <li>내가 보는 적의 위치 = <strong>100ms 전</strong> 서버가 보내준 위치</li>
                    <li>지금 서버에서 적의 <strong>실제 위치</strong> = 이미 다른 곳으로 이동함</li>
                </ul>
                <p><strong>내 총은 맞은 거야, 빗나간 거야?</strong></p>
            </div>

            <div class="answer-box">
                <h4>답</h4>
                <p>서버가 과거 시점으로 돌아가서 판정?</p>
            </div>

            <p><strong>정답!</strong> 이게 바로 <strong>"Lag Compensation (지연 보상)"</strong>의 핵심이에요.</p>

            <div class="insight-box">
                <h4>Lag Compensation 작동 원리</h4>
                <p>서버가 하는 일:</p>
                <ol>
                    <li>클라이언트의 핑(지연 시간)을 앎 (예: 100ms)</li>
                    <li>총 쏜 입력이 오면, <strong>100ms 전 과거 상태로 되감기 (Rewind)</strong></li>
                    <li>그 시점 기준으로 맞았는지 판정</li>
                    <li>다시 현재로 복귀</li>
                </ol>
            </div>

            <div class="diagram">현재 서버:    적이 B 위치 (벽 뒤)
100ms 전:     적이 A 위치 (내 조준선 위)
→ 판정: 맞음!</div>

            <p>그래서 <strong>내 화면에서 맞췄으면, 진짜로 맞은 걸로 처리해줍니다.</strong></p>

            <img src="step4.gif" alt="Lag Compensation 데모" class="demo-gif">
            <p style="text-align: center; color: #666; font-size: 0.9rem;">
                3개 화면에서 타겟 위치가 다름. 공격자가 자기 화면 기준으로 쏘면, 서버가 "REWIND"해서 판정
            </p>
        </section>

        <!-- 6. 피해자 입장 -->
        <section class="section">
            <h2>6. 벽 뒤에서 죽는 이유</h2>

            <div class="question-box">
                <h4>질문</h4>
                <p>이거 <strong>피해자 입장</strong>에서 생각해봐. 나는 분명히 벽 뒤로 숨었어. 근데 갑자기 죽었어. "뭐야?!" 왜 이런 일이 생길까?</p>
            </div>

            <div class="answer-box">
                <h4>답</h4>
                <p>공격자 화면에선 아직 내가 안 숨었으니까?</p>
            </div>

            <p>정확합니다!</p>

            <div class="diagram">피해자 시점:    "나 벽 뒤로 숨었는데?!"
공격자 시점:    "아직 안 숨었는데? 쏴! 맞았다!"
서버 판정:      공격자의 100ms 전 기준 → 맞음</div>

            <p>이게 그 유명한 <strong>"벽 뒤에서 죽는 현상"</strong>이에요.</p>

            <div class="warning-box">
                <h4>트레이드오프: 공격자 vs 피해자</h4>
                <p>게임 개발자는 <strong>선택</strong>을 해야 해요:</p>
            </div>

            <table>
                <tr>
                    <th>방식</th>
                    <th>공격자</th>
                    <th>피해자</th>
                </tr>
                <tr>
                    <td><strong>공격자 유리</strong></td>
                    <td style="color: #2e7d32;">내가 맞춘 건 맞음</td>
                    <td style="color: #c62828;">숨었는데 죽을 수 있음</td>
                </tr>
                <tr>
                    <td><strong>피해자 유리</strong></td>
                    <td style="color: #c62828;">분명 맞췄는데 안 맞음</td>
                    <td style="color: #2e7d32;">숨으면 안전함</td>
                </tr>
            </table>

            <p>대부분의 FPS는 <strong>공격자 유리</strong>를 선택해요. 왜?</p>
            <p><em>"쏘는 맛"이 게임의 핵심이니까요.</em></p>
        </section>

        <!-- 최종 정리 -->
        <section class="section">
            <h2>최종 정리</h2>

            <div class="summary-box">
                <h3>네트워크 지연 보상 4가지 핵심 기법</h3>
                <p><strong>1. 클라이언트 예측</strong> - 서버 기다리지 않고 내 캐릭터 먼저 움직임 → 즉각적인 반응감</p>
                <p><strong>2. 서버 재조정</strong> - 예측이 틀리면 서버 상태로 롤백 → 서버가 절대 권위</p>
                <p><strong>3. 보간</strong> - 다른 플레이어의 움직임을 부드럽게 이어줌 → 끊김 방지</p>
                <p><strong>4. Lag Compensation</strong> - 공격 판정 시 과거로 되감아서 검증 → 쏘는 맛 보장</p>
            </div>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>기법</th>
                        <th>대상</th>
                        <th>목적</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Client Prediction</td>
                        <td>내 캐릭터</td>
                        <td>입력 지연 숨기기</td>
                    </tr>
                    <tr>
                        <td>Server Reconciliation</td>
                        <td>내 캐릭터</td>
                        <td>서버와 동기화</td>
                    </tr>
                    <tr>
                        <td>Interpolation</td>
                        <td>다른 플레이어</td>
                        <td>부드러운 움직임</td>
                    </tr>
                    <tr>
                        <td>Lag Compensation</td>
                        <td>공격 판정</td>
                        <td>공정한 히트 판정</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <footer class="footer">
            <p>MSH Portfolio - Game Server Developer</p>
        </footer>
    </div>
</body>
</html>
