<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Lag Compensation - 네트워크 지연 보상</title>
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent-cyan: #00d4ff;
            --accent-green: #00ff88;
            --accent-yellow: #ffd43b;
            --accent-red: #ff6b6b;
            --accent-purple: #b388ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.8;
            padding: 40px 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
            padding-bottom: 40px;
            border-bottom: 1px solid var(--bg-tertiary);
        }

        h1 {
            font-size: 2.5rem;
            color: var(--accent-cyan);
            margin-bottom: 15px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
        }

        .intro-box {
            background: var(--bg-secondary);
            border-left: 4px solid var(--accent-cyan);
            padding: 25px 30px;
            margin-bottom: 50px;
            border-radius: 0 12px 12px 0;
        }

        .intro-box p {
            color: var(--text-secondary);
            font-size: 1.05rem;
        }

        section {
            margin-bottom: 60px;
        }

        h2 {
            font-size: 1.6rem;
            color: var(--accent-cyan);
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--bg-tertiary);
        }

        .question-box {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-left: 4px solid var(--accent-purple);
            padding: 20px 25px;
            margin-bottom: 20px;
            border-radius: 0 10px 10px 0;
        }

        .question-box::before {
            content: "Q.";
            color: var(--accent-purple);
            font-weight: bold;
            margin-right: 10px;
        }

        .answer-box {
            background: var(--bg-secondary);
            border-left: 4px solid var(--accent-green);
            padding: 20px 25px;
            margin-bottom: 25px;
            border-radius: 0 10px 10px 0;
        }

        .answer-box::before {
            content: "A.";
            color: var(--accent-green);
            font-weight: bold;
            margin-right: 10px;
        }

        .insight-box {
            background: linear-gradient(135deg, #1a2a1a 0%, #0d1f0d 100%);
            border: 1px solid #2d4a2d;
            padding: 20px 25px;
            margin: 25px 0;
            border-radius: 10px;
        }

        .insight-box::before {
            content: "핵심 개념";
            display: block;
            color: var(--accent-green);
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .problem-box {
            background: linear-gradient(135deg, #2a1a1a 0%, #1f0d0d 100%);
            border: 1px solid #4a2d2d;
            padding: 20px 25px;
            margin: 25px 0;
            border-radius: 10px;
        }

        .problem-box::before {
            content: "문제 상황";
            display: block;
            color: var(--accent-red);
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .tradeoff-box {
            background: linear-gradient(135deg, #2a2a1a 0%, #1f1f0d 100%);
            border: 1px solid #4a4a2d;
            padding: 20px 25px;
            margin: 25px 0;
            border-radius: 10px;
        }

        .tradeoff-box::before {
            content: "트레이드오프";
            display: block;
            color: var(--accent-yellow);
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .visual-demo {
            margin: 30px 0;
            text-align: center;
        }

        .visual-demo img {
            max-width: 100%;
            border-radius: 12px;
            border: 2px solid var(--bg-tertiary);
        }

        .visual-demo .caption {
            margin-top: 15px;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        code {
            background: var(--bg-tertiary);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            color: var(--accent-yellow);
            font-size: 0.95em;
        }

        pre {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .timeline {
            position: relative;
            padding-left: 30px;
            margin: 20px 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--accent-cyan);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 15px;
            padding: 10px 15px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 50%;
            transform: translateY(-50%);
            width: 10px;
            height: 10px;
            background: var(--accent-cyan);
            border-radius: 50%;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: left;
            border: 1px solid var(--bg-tertiary);
        }

        .comparison-table th {
            background: var(--bg-tertiary);
            color: var(--accent-cyan);
        }

        .comparison-table tr:nth-child(even) {
            background: var(--bg-secondary);
        }

        .summary-box {
            background: linear-gradient(135deg, #1a1a2e 0%, #0d1f2e 100%);
            border: 2px solid var(--accent-cyan);
            padding: 30px;
            margin: 40px 0;
            border-radius: 12px;
        }

        .summary-box h3 {
            color: var(--accent-cyan);
            margin-bottom: 20px;
        }

        .summary-box ul {
            list-style: none;
            padding: 0;
        }

        .summary-box li {
            padding: 10px 0;
            padding-left: 25px;
            position: relative;
        }

        .summary-box li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--accent-green);
        }

        .back-link {
            display: inline-block;
            margin-top: 40px;
            color: var(--accent-cyan);
            text-decoration: none;
            padding: 10px 20px;
            border: 1px solid var(--accent-cyan);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: var(--accent-cyan);
            color: var(--bg-primary);
        }

        strong {
            color: var(--accent-cyan);
        }

        .highlight-red { color: var(--accent-red); }
        .highlight-green { color: var(--accent-green); }
        .highlight-yellow { color: var(--accent-yellow); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Network Lag Compensation</h1>
            <p class="subtitle">온라인 게임에서 네트워크 지연을 어떻게 처리할까?</p>
        </header>

        <div class="intro-box">
            <p>
                온라인 게임을 할 때 "렉 걸린다", "핑이 높다"는 말을 많이 하죠.
                하지만 실제로 게임은 어떻게 이 지연을 처리하고, 왜 가끔 벽 뒤에서 죽는 걸까요?
                네트워크 지연 보상의 원리를 처음부터 차근차근 알아봅시다.
            </p>
        </div>

        <!-- Section 1: 네트워크 지연이란? -->
        <section>
            <h2>1. 네트워크 지연이란?</h2>

            <div class="question-box">
                온라인 게임에서 내가 키보드로 "앞으로 이동" 키를 눌렀어. 이 입력이 서버에 도착하려면 어떤 과정을 거칠까?
            </div>

            <div class="answer-box">
                네트워크를 통해 전송되니까 몇 ms 정도 걸리지 않을까?
            </div>

            <p>맞아. 서울-부산 정도면 약 <code>10~30ms</code>, 해외 서버면 <code>100~200ms</code>도 걸려.</p>

            <div class="timeline">
                <div class="timeline-item">1. 내가 "앞으로" 키를 누름</div>
                <div class="timeline-item">2. 입력이 서버로 감 (30ms)</div>
                <div class="timeline-item">3. 서버가 캐릭터 이동 처리</div>
                <div class="timeline-item">4. 서버가 결과를 나에게 보냄 (30ms)</div>
            </div>

            <div class="problem-box">
                <strong>왕복 60ms</strong> 후에야 내 화면에서 캐릭터가 움직여.
                키 누르고 0.06초 후에 움직이면 플레이어 입장에서 <span class="highlight-red">답답하고 렉 걸리는 느낌</span>이야.
                해외 서버 200ms면? 거의 게임 불가 수준.
            </div>

            <div class="question-box">
                근데 실제로 배틀그라운드나 롤 같은 게임, 해외 서버 접속해도 내 캐릭터는 키 누르자마자 바로 움직이잖아?
            </div>
        </section>

        <!-- Section 2: 클라이언트 예측 -->
        <section>
            <h2>2. 클라이언트 예측 (Client-side Prediction)</h2>

            <div class="answer-box">
                클라이언트가 먼저 움직이고 서버한테 알려주는 방식?
            </div>

            <div class="insight-box">
                <strong>클라이언트 예측 (Client-side Prediction)</strong><br><br>
                서버 응답 기다리지 말고, 클라이언트가 "나 이렇게 움직일 거야"라고 <strong>먼저 예측해서 화면에 보여주는 것</strong>.
                그래서 키 누르면 바로 움직이는 것처럼 느껴진다.
            </div>

            <div class="visual-demo">
                <img src="step1.gif" alt="Client Prediction Demo">
                <p class="caption">
                    <span class="highlight-red">왼쪽(OFF)</span>: 서버 응답 기다림 - 답답함<br>
                    <span class="highlight-green">오른쪽(ON)</span>: 즉시 반응 - 부드러움
                </p>
            </div>
        </section>

        <!-- Section 3: 서버 재조정 -->
        <section>
            <h2>3. 서버 재조정과 러버밴딩</h2>

            <div class="question-box">
                클라이언트가 "앞으로 이동"했는데, 서버에서 확인해보니 그 타이밍에 나는 적한테 맞아서 기절 상태였어.
                클라이언트는 이미 캐릭터를 앞으로 움직여서 보여줬는데, 서버는 "아니, 너 못 움직여"라고 해. 어떻게 처리해야 할까?
            </div>

            <div class="answer-box">
                서버 결과로 되돌려야 하지 않을까?
            </div>

            <div class="insight-box">
                <strong>서버 재조정 (Server Reconciliation)</strong><br><br>
                핵심 원칙: <strong>서버가 절대 권위 (Server Authority)</strong><br>
                클라이언트가 뭘 보여줬든, 서버 결과가 "진짜"야.
                클라이언트 예측이 틀렸으면? → 서버 상태로 <strong>강제로 되돌림</strong>
            </div>

            <div class="question-box">
                플레이어 눈에는 어떻게 보일까?
            </div>

            <div class="answer-box">
                좋은 품질의 게임일수록 내가 '안 움직였는데' 갑자기 서버에 의해 내 의도치 않게 강제적으로 돌아가는 건 썩 불쾌한 경험일 것 같은데.
            </div>

            <p>정확해. 캐릭터가 앞으로 갔다가 갑자기 <strong>"휙"</strong> 하고 원래 위치로 튕겨져 돌아오는 거야.
            이걸 <strong class="highlight-yellow">"러버밴딩 (Rubber-banding)"</strong>이라고 해. 고무줄처럼 튕겨 돌아오는 현상.</p>

            <div class="visual-demo">
                <img src="step2.gif" alt="Rubberbanding Demo">
                <p class="caption">
                    클라이언트가 벽을 통과하려 하면, 서버가 거부하고 <span class="highlight-red">롤백</span> 발생
                </p>
            </div>

            <p>좋은 게임일수록 이게 안 느껴져야 해:</p>
            <ul style="margin: 15px 0 15px 20px;">
                <li>클라이언트와 서버가 <strong>똑같은 게임 로직</strong> 사용</li>
                <li>예측이 거의 안 틀리게 만듦</li>
                <li>롤백이 필요해도 <strong>부드럽게</strong> 보정 (갑자기 텔레포트 X)</li>
            </ul>
        </section>

        <!-- Section 4: 다른 플레이어 - 보간 -->
        <section>
            <h2>4. 다른 플레이어는 어떻게 보일까?</h2>

            <div class="question-box">
                여기까지는 "내 캐릭터" 얘기였어. 근데 온라인 게임엔 다른 플레이어도 있잖아.
                상대방 캐릭터 위치 정보는 어디서 와? 그리고 그 정보도 네트워크 지연이 있을 텐데...
            </div>

            <div class="answer-box">
                끊기거나 뚝뚝 끊겨 보이지 않을까?
            </div>

            <p>맞아. 서버가 초당 30번(30틱) 위치를 보내면, 그 사이사이는 <strong>정보가 없어서</strong> 뚝뚝 끊겨 보여.</p>

            <div class="insight-box">
                <strong>보간 (Interpolation)</strong><br><br>
                위치 A에서 위치 B로 갈 때, 그 <strong>사이를 부드럽게 이어주는 것</strong>.
<pre>
받은 정보:  A -------- B -------- C
보간 적용:  A ~ ~ ~ ~ B ~ ~ ~ ~ C  (부드럽게 채움)
</pre>
            </div>

            <div class="visual-demo">
                <img src="step3.gif" alt="Interpolation Demo">
                <p class="caption">
                    <span class="highlight-red">왼쪽(OFF)</span>: 뚝뚝 순간이동<br>
                    <span class="highlight-green">오른쪽(ON)</span>: 부드럽게 이동
                </p>
            </div>
        </section>

        <!-- Section 5: Lag Compensation -->
        <section>
            <h2>5. 총은 맞은 거야, 빗나간 거야?</h2>

            <div class="question-box">
                FPS 게임이야. 내가 적을 조준해서 총을 쐈어. 내 화면에서는 분명히 맞았어.<br><br>
                근데 생각해봐:<br>
                - 내가 보는 적의 위치 = <strong>100ms 전</strong> 서버가 보내준 위치<br>
                - 지금 서버에서 적의 <strong>실제 위치</strong> = 이미 다른 곳으로 이동함<br><br>
                내 총은 맞은 거야, 빗나간 거야?
            </div>

            <div class="answer-box">
                서버가 과거 시점으로 돌아가서 판정?
            </div>

            <div class="insight-box">
                <strong>Lag Compensation (지연 보상)</strong><br><br>
                서버가 하는 일:
                <ol style="margin: 10px 0 0 20px;">
                    <li>클라이언트의 핑(지연 시간)을 앎 (예: 100ms)</li>
                    <li>총 쏜 입력이 오면, <strong>100ms 전 과거 상태로 되감기 (Rewind)</strong></li>
                    <li>그 시점 기준으로 맞았는지 판정</li>
                    <li>다시 현재로 복귀</li>
                </ol>
            </div>

<pre>
현재 서버:    적이 B 위치 (벽 뒤)
100ms 전:     적이 A 위치 (내 조준선 위)
→ 판정: 맞음!
</pre>

            <p>그래서 <strong>내 화면에서 맞췄으면, 진짜로 맞은 걸로 처리해줌.</strong></p>

            <div class="visual-demo">
                <img src="step4.gif" alt="Lag Compensation Demo">
                <p class="caption">
                    3개 화면에서 타겟 위치가 다름<br>
                    공격자가 자기 화면 기준으로 쏘면, 서버가 <span class="highlight-yellow">"REWIND"</span>해서 판정
                </p>
            </div>
        </section>

        <!-- Section 6: 피해자 입장 -->
        <section>
            <h2>6. 벽 뒤에서 죽는 이유</h2>

            <div class="question-box">
                이거 피해자 입장에서 생각해봐. 나는 분명히 벽 뒤로 숨었어. 근데 갑자기 죽었어. "뭐야?!"
                왜 이런 일이 생길까?
            </div>

            <div class="answer-box">
                공격자 화면에선 아직 내가 안 숨었으니까?
            </div>

<pre>
피해자 시점:    "나 벽 뒤로 숨었는데?!"
공격자 시점:    "아직 안 숨었는데? 쏴! 맞았다!"
서버 판정:      공격자의 100ms 전 기준 → 맞음
</pre>

            <p>이게 그 유명한 <strong class="highlight-red">"벽 뒤에서 죽는 현상"</strong>이야.</p>

            <div class="tradeoff-box">
                게임 개발자는 <strong>선택</strong>을 해야 해:

                <table class="comparison-table" style="margin-top: 15px;">
                    <tr>
                        <th>방식</th>
                        <th>공격자</th>
                        <th>피해자</th>
                    </tr>
                    <tr>
                        <td><strong>공격자 유리</strong></td>
                        <td class="highlight-green">내가 맞춘 건 맞음</td>
                        <td class="highlight-red">숨었는데 죽을 수 있음</td>
                    </tr>
                    <tr>
                        <td><strong>피해자 유리</strong></td>
                        <td class="highlight-red">분명 맞췄는데 안 맞음</td>
                        <td class="highlight-green">숨으면 안전함</td>
                    </tr>
                </table>

                <p style="margin-top: 15px;">대부분의 FPS는 <strong>공격자 유리</strong>를 선택해. 왜?</p>
                <p><em>"쏘는 맛"이 게임의 핵심이니까.</em></p>
            </div>
        </section>

        <!-- Summary -->
        <section>
            <h2>7. 정리</h2>

            <div class="summary-box">
                <h3>네트워크 지연 보상 4가지 핵심 기법</h3>
                <ul>
                    <li><strong>클라이언트 예측</strong>: 서버 기다리지 않고 내 캐릭터 먼저 움직임 → 즉각적인 반응감</li>
                    <li><strong>서버 재조정</strong>: 예측이 틀리면 서버 상태로 롤백 → 서버가 절대 권위</li>
                    <li><strong>보간</strong>: 다른 플레이어의 움직임을 부드럽게 이어줌 → 끊김 방지</li>
                    <li><strong>Lag Compensation</strong>: 공격 판정 시 과거로 되감아서 검증 → 쏘는 맛 보장</li>
                </ul>
            </div>

            <table class="comparison-table">
                <tr>
                    <th>기법</th>
                    <th>대상</th>
                    <th>목적</th>
                </tr>
                <tr>
                    <td>Client Prediction</td>
                    <td>내 캐릭터</td>
                    <td>입력 지연 숨기기</td>
                </tr>
                <tr>
                    <td>Server Reconciliation</td>
                    <td>내 캐릭터</td>
                    <td>서버와 동기화</td>
                </tr>
                <tr>
                    <td>Interpolation</td>
                    <td>다른 플레이어</td>
                    <td>부드러운 움직임</td>
                </tr>
                <tr>
                    <td>Lag Compensation</td>
                    <td>공격 판정</td>
                    <td>공정한 히트 판정</td>
                </tr>
            </table>
        </section>

        <a href="../network/" class="back-link">← 네트워크 목록으로</a>
    </div>
</body>
</html>
