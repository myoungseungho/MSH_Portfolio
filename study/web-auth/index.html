<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>웹서버 인증 시스템 - MSH Portfolio</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #fafafa;
            color: #333;
            line-height: 1.8;
        }
        .container { max-width: 900px; margin: 0 auto; padding: 60px 20px; }
        .back-link {
            display: inline-block;
            margin-bottom: 24px;
            color: #666;
            text-decoration: none;
        }
        .back-link:hover { color: #111; }
        .header { margin-bottom: 48px; }
        .header h1 { font-size: 2rem; font-weight: 700; color: #111; margin-bottom: 8px; }
        .header p { color: #666; }
        .section { margin-bottom: 48px; }
        .section h2 {
            font-size: 1.4rem;
            font-weight: 600;
            color: #111;
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 2px solid #eee;
        }
        .section h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin: 24px 0 12px 0;
        }
        .section p { margin-bottom: 16px; color: #444; }
        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 16px 0;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        code {
            font-family: 'Consolas', 'Monaco', monospace;
        }
        .inline-code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        .concept-box {
            background: #f8f9fa;
            border-left: 4px solid #4CAF50;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        .concept-box h4 {
            color: #2e7d32;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        .warning-box {
            background: #fff8e1;
            border-left: 4px solid #ff9800;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        .warning-box h4 {
            color: #e65100;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        .flow-diagram {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 24px;
            margin: 20px 0;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            line-height: 1.8;
            overflow-x: auto;
            white-space: pre;
        }
        .compare-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        .compare-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
        }
        .compare-card h4 {
            font-size: 1rem;
            margin-bottom: 12px;
            color: #111;
        }
        .compare-card ul {
            list-style: none;
            padding: 0;
        }
        .compare-card li {
            padding: 4px 0;
            padding-left: 20px;
            position: relative;
        }
        .compare-card li::before {
            content: "•";
            position: absolute;
            left: 0;
            color: #4CAF50;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #e0e0e0;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #f5f5f5;
            font-weight: 600;
        }
        .keyword {
            color: #569cd6;
        }
        .string {
            color: #ce9178;
        }
        .comment {
            color: #6a9955;
        }
        .function {
            color: #dcdcaa;
        }
        .footer {
            text-align: center;
            padding: 40px 0;
            color: #999;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../" class="back-link">← 메인으로</a>

        <header class="header">
            <h1>웹서버 인증 시스템</h1>
            <p>모바일 게임의 로그인 인증 구조 이해하기</p>
        </header>

        <!-- 1. 왜 인증이 필요한가 -->
        <section class="section">
            <h2>1. 왜 인증이 필요한가?</h2>

            <p>모바일 게임을 실행하면 "구글로 로그인", "카카오로 로그인" 같은 버튼이 나옵니다. 이 과정에서 <strong>인증(Authentication)</strong>이 필요합니다.</p>

            <div class="concept-box">
                <h4>인증이란?</h4>
                <p>"이 사람이 정말 본인인지 확인하는 것"</p>
                <p>만약 인증 없이 "나 홍길동이야"라고 문자열만 보내면, 누구나 홍길동인 척 할 수 있습니다.</p>
            </div>
        </section>

        <!-- 2. 토큰이란? -->
        <section class="section">
            <h2>2. 토큰(Token)이란?</h2>

            <p>토큰은 <strong>위조가 불가능한 디지털 출입증</strong>입니다.</p>

            <h3>놀이공원 비유</h3>
            <div class="flow-diagram">놀이공원 입구에서 티켓을 사면 손목에 밴드를 채워줍니다.

그 밴드가 "토큰"입니다.
- 놀이기구 탈 때마다 신분증 보여줄 필요 없음
- 손목 밴드만 보여주면 "아, 돈 낸 사람이구나" 확인 끝</div>

            <h3>토큰의 구조</h3>
            <p>토큰 안에는 이런 정보가 암호화되어 들어있습니다:</p>
<pre><code>{
    <span class="string">"user_id"</span>: <span class="string">"hong123"</span>,       <span class="comment">// 이 사람이 누구인지</span>
    <span class="string">"issuer"</span>: <span class="string">"Firebase"</span>,       <span class="comment">// 누가 발급했는지</span>
    <span class="string">"expires"</span>: <span class="string">"2025-02-01"</span>,    <span class="comment">// 언제까지 유효한지</span>
    <span class="string">"signature"</span>: <span class="string">"aX7k9mZ2..."</span>  <span class="comment">// 서명 (위조 방지)</span>
}</code></pre>

            <div class="warning-box">
                <h4>서명(Signature)이 핵심!</h4>
                <p>해커가 내용을 똑같이 만들어도 <strong>서명은 만들 수 없습니다</strong>. 서명은 발급자만 아는 비밀 키로 생성되기 때문입니다.</p>
            </div>
        </section>

        <!-- 3. 비대칭 암호화 -->
        <section class="section">
            <h2>3. 토큰은 어떻게 검증하나? (비대칭 암호화)</h2>

            <p>토큰 발급과 검증에는 <strong>비대칭 암호화</strong>가 사용됩니다.</p>

            <div class="compare-grid">
                <div class="compare-card">
                    <h4>비밀 키 (Private Key)</h4>
                    <ul>
                        <li>토큰 발급자만 보관</li>
                        <li>토큰에 서명할 때 사용</li>
                        <li>절대 외부에 공개하면 안 됨</li>
                    </ul>
                </div>
                <div class="compare-card">
                    <h4>공개 키 (Public Key)</h4>
                    <ul>
                        <li>누구나 가질 수 있음</li>
                        <li>서명이 진짜인지 검증할 때 사용</li>
                        <li>미리 받아서 서버에 저장</li>
                    </ul>
                </div>
            </div>

            <h3>도장 비유</h3>
            <div class="flow-diagram">비밀 키 = 진짜 도장 (발급자만 가짐)
토큰     = 도장 찍힌 문서 (클라이언트가 들고 다님)
공개 키  = 도장 감별 도구 (검증하는 서버가 가짐)

→ 도장 찍는 건 발급자만 가능
→ 도장 확인은 공개 키로 누구나 가능</div>

            <div class="concept-box">
                <h4>왜 공개 키로 직접 검증하나?</h4>
                <p>매번 발급자한테 "이거 진짜야?"라고 물어보면 느리고, 발급자 서버가 터지면 우리도 못 씁니다. 공개 키가 있으면 발급자 없이도 혼자서 검증할 수 있습니다.</p>
            </div>
        </section>

        <!-- 4. Firebase란? -->
        <section class="section">
            <h2>4. Firebase란?</h2>

            <p>구글, 애플, 카카오, 네이버... 로그인 방식이 다 다릅니다. 이걸 전부 따로 처리하면 너무 복잡해집니다.</p>

            <p><strong>Firebase</strong>는 구글이 만든 "로그인 대행 서비스"입니다.</p>

            <div class="flow-diagram">        Firebase (중간 대행)
              ↑
    ┌────┬────┼────┬────┐
    │    │    │    │    │
  구글  애플 카카오 네이버 게스트</div>

            <div class="concept-box">
                <h4>Firebase의 역할</h4>
                <p>"야, 너희 서버는 나한테만 물어봐. 구글이든 애플이든 내가 다 확인해서 <strong>통일된 형식의 토큰</strong>으로 알려줄게."</p>
            </div>

            <h3>Firebase가 기본 지원하는 것</h3>
            <table>
                <tr>
                    <th>로그인 방식</th>
                    <th>Firebase 지원</th>
                    <th>처리 방법</th>
                </tr>
                <tr>
                    <td>구글</td>
                    <td>O (자동)</td>
                    <td>클라이언트가 직접 Firebase 토큰 받음</td>
                </tr>
                <tr>
                    <td>애플</td>
                    <td>O (자동)</td>
                    <td>클라이언트가 직접 Firebase 토큰 받음</td>
                </tr>
                <tr>
                    <td>카카오</td>
                    <td>X</td>
                    <td>웹서버가 수동으로 변환</td>
                </tr>
                <tr>
                    <td>네이버</td>
                    <td>X</td>
                    <td>웹서버가 수동으로 변환</td>
                </tr>
            </table>
        </section>

        <!-- 5. 로그인 흐름 -->
        <section class="section">
            <h2>5. 실제 로그인 흐름</h2>

            <h3>구글/애플 로그인 (Firebase 기본 지원)</h3>
            <div class="flow-diagram">클라이언트                Firebase                 웹서버
    │                        │                       │
    │ ① "구글로 로그인"       │                       │
    │ ─────────────────────▶│                       │
    │                        │                       │
    │ ② Firebase 토큰        │                       │
    │◀───────────────────── │                       │
    │                        │                       │
    │ ③ "이 토큰으로 인증해줘"                        │
    │ ──────────────────────────────────────────────▶
    │                                                │
    │                        ④ 공개 키로 토큰 검증    │
    │                                                │
    │ ⑤ 우리 게임 JWT 발급                            │
    │◀──────────────────────────────────────────────│</div>

            <h3>카카오/네이버 로그인 (수동 변환 필요)</h3>
            <div class="flow-diagram">클라이언트      카카오        웹서버                Firebase
    │             │             │                      │
    │ ① 로그인    │             │                      │
    │ ───────────▶│             │                      │
    │             │             │                      │
    │ ② 카카오 토큰│             │                      │
    │◀─────────── │             │                      │
    │             │             │                      │
    │ ③ "이 카카오 토큰 변환해줘"│                      │
    │ ─────────────────────────▶│                      │
    │                           │                      │
    │                           │ ④ "이 사람 맞아?"    │
    │                           │ ────────────────────▶│
    │                           │                      │
    │                           │ ⑤ "맞아, 여기 토큰"  │
    │                           │◀──────────────────── │
    │                           │                      │
    │ ⑥ 우리 게임 JWT 발급      │                      │
    │◀───────────────────────── │                      │</div>

            <div class="concept-box">
                <h4>차이점 정리</h4>
                <p><strong>구글/애플:</strong> 클라이언트가 Firebase 토큰을 직접 들고 옴</p>
                <p><strong>카카오/네이버:</strong> 클라이언트가 각 플랫폼 토큰을 들고 옴 → 웹서버가 Firebase 토큰으로 변환</p>
            </div>
        </section>

        <!-- 5.5 소셜 로그인 심화 -->
        <section class="section">
            <h2>5-1. 소셜 로그인 심화 (카카오/네이버)</h2>

            <p>카카오/네이버는 Firebase가 기본 지원하지 않습니다. 그래서 웹서버가 중간 다리 역할을 합니다.</p>

            <h3>왜 카카오 토큰을 카카오에 다시 물어볼까?</h3>
            <p>클라이언트가 "나 카카오 유저야"라고 토큰을 보내도, <strong>그게 진짜인지 확인해야 합니다.</strong></p>

            <div class="flow-diagram">클라이언트: "이 카카오 토큰 봐, 나 진짜야"
웹서버: "잠깐, 카카오한테 물어볼게"
웹서버 → 카카오: "이 토큰 진짜야?"
카카오 → 웹서버: "응 맞아, ID는 12345야"</div>

            <div class="concept-box">
                <h4>결제 검증과 같은 원리!</h4>
                <p>결제 시스템에서 영수증을 스토어에 검증하는 것처럼, 소셜 토큰도 발급자에게 검증합니다.</p>
            </div>

            <h3>Custom Token vs ID Token</h3>
            <p>Firebase에서 두 종류의 토큰이 있습니다:</p>

            <div class="compare-grid">
                <div class="compare-card">
                    <h4>Custom Token (입장권)</h4>
                    <ul>
                        <li>웹서버가 만들어서 클라이언트에게 줌</li>
                        <li>"이걸로 Firebase에 로그인해"</li>
                        <li>로그인 전 상태</li>
                    </ul>
                </div>
                <div class="compare-card">
                    <h4>ID Token (신분증)</h4>
                    <ul>
                        <li>Firebase가 로그인 후 발급</li>
                        <li>"나 Firebase에 로그인됐어"</li>
                        <li>로그인 완료 상태</li>
                    </ul>
                </div>
            </div>

            <h3>카카오 로그인 전체 흐름</h3>
            <div class="flow-diagram">1. 클라이언트 → 카카오: 로그인
2. 카카오 → 클라이언트: 카카오 access_token 발급
3. 클라이언트 → 웹서버: "이 카카오 토큰 처리해줘"
4. 웹서버 → 카카오: "이 토큰 진짜야?" → OK
5. 웹서버 → Firebase: "kakao:12345 유저 등록해줘"
6. 웹서버: Custom Token 생성 (입장권)
7. 웹서버 → 클라이언트: "이 입장권 가져가"
8. 클라이언트 → Firebase: 입장권으로 로그인
9. Firebase → 클라이언트: ID Token 발급 (신분증)
10. 클라이언트 → 웹서버: "이 신분증으로 JWT 줘"
11. 웹서버 → 클라이언트: 우리 게임 JWT 발급</div>

            <h3>왜 Firebase를 거칠까?</h3>
            <p>"카카오 인증 확인했으면 바로 JWT 주면 안 돼?" 라는 의문이 들 수 있습니다.</p>

            <div class="concept-box">
                <h4>Firebase로 통합하는 이유</h4>
                <p>모든 유저를 Firebase Auth 한 곳에서 관리할 수 있습니다:</p>
            </div>

            <div class="flow-diagram">Firebase Auth (통합 유저 DB)
├── google:abc123     → 구글로 가입한 유저
├── apple:def456      → 애플로 가입한 유저
├── kakao:12345       → 카카오로 가입한 유저
├── naver:67890       → 네이버로 가입한 유저</div>

            <p><strong>장점:</strong></p>
            <ul>
                <li>한 곳에서 모든 유저 조회/관리 가능</li>
                <li>어떤 방법으로 로그인했든 동일한 인증 흐름</li>
                <li>Firebase의 푸시 알림, 분석 등 다른 기능도 사용 가능</li>
            </ul>

            <h3>네임스페이스로 충돌 방지</h3>
            <p>카카오 유저 ID가 12345이고, 네이버 유저 ID도 우연히 12345라면?</p>

            <div class="flow-diagram">❌ 잘못된 방식
   12345 → 누구야? 카카오? 네이버?

✅ 올바른 방식
   kakao:12345 → 카카오 유저
   naver:12345 → 네이버 유저 (완전히 다른 사람)</div>

            <div class="warning-box">
                <h4>접두사(Prefix)가 네임스페이스 역할</h4>
                <p>플랫폼 이름을 접두사로 붙여서 충돌을 방지합니다. C++의 namespace와 같은 개념입니다.</p>
            </div>
        </section>

        <!-- 6. Firebase 토큰 vs 우리 JWT -->
        <section class="section">
            <h2>6. Firebase 토큰 vs 우리 게임 JWT</h2>

            <p>Firebase 토큰을 받았는데 왜 또 JWT를 만들까요?</p>

            <div class="compare-grid">
                <div class="compare-card">
                    <h4>Firebase 토큰</h4>
                    <ul>
                        <li>"이 사람은 구글 유저 abc123이야"</li>
                        <li>신원 확인용</li>
                        <li>Firebase가 발급</li>
                    </ul>
                </div>
                <div class="compare-card">
                    <h4>우리 게임 JWT</h4>
                    <ul>
                        <li>"이 사람은 우리 게임 계정 12345야"</li>
                        <li>게임 이용 자격 확인용</li>
                        <li>우리 웹서버가 발급</li>
                    </ul>
                </div>
            </div>

            <h3>비유</h3>
            <div class="flow-diagram">Firebase 토큰 = 여권 (국제 신분증)
   → "나는 한국인 홍길동입니다"

우리 JWT = 사원증 (회사 내부용)
   → "나는 사번 12345입니다"

회사 출입할 때 여권 말고 사원증 보여줘야 합니다.</div>

            <h3>왜 변환이 필요한가?</h3>
            <p>게임 서버는 "구글 유저 abc123"을 모릅니다. 게임 서버는 <strong>우리 DB에 있는 계정번호</strong>를 알아야 합니다.</p>

<pre><code><span class="comment">// Firebase 토큰 안의 정보</span>
{
    <span class="string">"google_id"</span>: <span class="string">"abc123"</span>,
    <span class="string">"email"</span>: <span class="string">"hong@gmail.com"</span>
}

<span class="comment">// 우리 JWT 안의 정보</span>
{
    <span class="string">"account_id"</span>: <span class="number">12345</span>,   <span class="comment">// 우리 DB의 계정번호</span>
    <span class="string">"expires"</span>: <span class="string">"30일 후"</span>
}</code></pre>
        </section>

        <!-- 7. 전체 인증 흐름 -->
        <section class="section">
            <h2>7. 전체 인증 흐름 정리</h2>

            <div class="flow-diagram">┌─────────────────────────────────────────────────────────────┐
│                      인증 웹서버                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ① 클라이언트가 Firebase 토큰(또는 카카오/네이버 토큰) 전달  │
│                          ↓                                   │
│  ② Firebase 토큰 검증 (공개 키로)                            │
│     → "신원 확인 완료"                                       │
│                          ↓                                   │
│  ③ 우리 DB에서 계정 찾기 (없으면 신규 생성)                  │
│     → "구글 유저 abc123 = 우리 계정 12345"                   │
│                          ↓                                   │
│  ④ 우리 게임 JWT 발급                                        │
│     → "계정 12345, 30일간 유효"                              │
│                          ↓                                   │
│  ⑤ 클라이언트에게 JWT 전달                                   │
│                                                              │
└─────────────────────────────────────────────────────────────┘
                           ↓
              클라이언트는 이 JWT로 게임 서버 접속</div>

            <table>
                <tr>
                    <th>단계</th>
                    <th>검증 내용</th>
                    <th>결과</th>
                </tr>
                <tr>
                    <td>Firebase 토큰 검증</td>
                    <td>"이 사람이 진짜 누구인지"</td>
                    <td>신원 확인</td>
                </tr>
                <tr>
                    <td>우리 JWT 발급</td>
                    <td>"이 사람이 우리 게임 유저인지"</td>
                    <td>게임 이용 자격</td>
                </tr>
            </table>
        </section>

        <!-- 정리 -->
        <section class="section">
            <h2>8. 핵심 정리</h2>

            <table>
                <tr>
                    <th>개념</th>
                    <th>설명</th>
                    <th>비유</th>
                </tr>
                <tr>
                    <td>토큰</td>
                    <td>위조 불가능한 디지털 출입증</td>
                    <td>손목 밴드</td>
                </tr>
                <tr>
                    <td>비밀 키</td>
                    <td>토큰 발급에 사용, 발급자만 보관</td>
                    <td>진짜 도장</td>
                </tr>
                <tr>
                    <td>공개 키</td>
                    <td>토큰 검증에 사용, 누구나 가질 수 있음</td>
                    <td>도장 감별 도구</td>
                </tr>
                <tr>
                    <td>Firebase</td>
                    <td>여러 로그인을 통합해주는 대행 서비스</td>
                    <td>출입국 심사 대행</td>
                </tr>
                <tr>
                    <td>Firebase 토큰</td>
                    <td>신원 확인용</td>
                    <td>여권</td>
                </tr>
                <tr>
                    <td>우리 JWT</td>
                    <td>게임 이용 자격 확인용</td>
                    <td>사원증</td>
                </tr>
            </table>
        </section>

        <footer class="footer">
            <p>MSH Portfolio - Game Server Developer</p>
        </footer>
    </div>
</body>
</html>
