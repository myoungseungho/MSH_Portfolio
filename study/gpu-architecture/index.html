<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU 아키텍처 기초 - MSH Portfolio</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #fafafa;
            color: #333;
            line-height: 1.8;
        }
        .container { max-width: 900px; margin: 0 auto; padding: 60px 20px; }
        .back-link {
            display: inline-block;
            margin-bottom: 24px;
            color: #666;
            text-decoration: none;
        }
        .back-link:hover { color: #111; }
        .header { margin-bottom: 48px; }
        .header h1 { font-size: 2rem; font-weight: 700; color: #111; margin-bottom: 12px; }
        .header p { color: #666; font-size: 1.1rem; }

        section { margin-bottom: 48px; }
        section h2 {
            font-size: 1.4rem;
            font-weight: 600;
            color: #111;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e0e0e0;
        }
        section h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin: 24px 0 12px 0;
        }
        p { margin-bottom: 16px; color: #444; }

        .concept-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 24px;
            margin: 20px 0;
            border-left: 4px solid #9C27B0;
        }
        .concept-box.key {
            border-left-color: #4CAF50;
            background: #f1f8e9;
        }
        .concept-box.warning {
            border-left-color: #FF9800;
            background: #fff8e1;
        }
        .concept-box h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: #111;
        }

        .diagram {
            background: #1e1e1e;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            color: #d4d4d4;
            overflow-x: auto;
            white-space: pre;
        }

        .code-block {
            background: #1e1e1e;
            border-radius: 8px;
            padding: 20px;
            margin: 16px 0;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            color: #d4d4d4;
            white-space: pre;
        }
        .code-block .comment { color: #6A9955; }
        .code-block .keyword { color: #569CD6; }
        .code-block .type { color: #4EC9B0; }
        .code-block .number { color: #B5CEA8; }
        .code-block .function { color: #DCDCAA; }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background: #f5f5f5;
            font-weight: 600;
            color: #333;
        }
        tr:hover { background: #fafafa; }

        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
        }

        .vs-table {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .vs-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e0e0e0;
        }
        .vs-card h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid;
        }
        .vs-card.cpu h4 { border-color: #2196F3; color: #2196F3; }
        .vs-card.gpu h4 { border-color: #9C27B0; color: #9C27B0; }
        .vs-card ul {
            list-style: none;
            padding: 0;
        }
        .vs-card li {
            padding: 6px 0;
            font-size: 0.9rem;
            color: #555;
        }

        .nav-links {
            display: flex;
            justify-content: space-between;
            margin-top: 60px;
            padding-top: 24px;
            border-top: 1px solid #e0e0e0;
        }
        .nav-links a {
            color: #9C27B0;
            text-decoration: none;
        }
        .nav-links a:hover { text-decoration: underline; }

        .summary-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .summary-table th {
            background: #9C27B0;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../category-gpu/" class="back-link">← GPU / 그래픽스 목록</a>

        <header class="header">
            <h1>GPU 아키텍처 기초</h1>
            <p>CPU와 다른 GPU의 병렬 처리 구조 이해하기</p>
        </header>

        <!-- 1. GPU vs CPU -->
        <section>
            <h2>1. GPU vs CPU 구조 비교</h2>

            <div class="vs-table">
                <div class="vs-card cpu">
                    <h4>CPU</h4>
                    <ul>
                        <li>코어 8~16개 (적음)</li>
                        <li>각 코어가 강력하고 복잡</li>
                        <li>분기 예측, 파이프라인 최적화</li>
                        <li>각자 다른 일 가능</li>
                    </ul>
                </div>
                <div class="vs-card gpu">
                    <h4>GPU</h4>
                    <ul>
                        <li>코어 수천 개 (많음)</li>
                        <li>각 코어가 단순함</li>
                        <li>같은 연산을 대량 병렬 처리</li>
                        <li>같은 일을 동시에</li>
                    </ul>
                </div>
            </div>

            <div class="concept-box">
                <h4>비유</h4>
                <p><strong>CPU</strong> = 박사급 직원 8명 → 복잡한 문제 해결 가능, 각자 다른 일 가능</p>
                <p><strong>GPU</strong> = 단순 작업자 4000명 → 단순 계산만, 대신 동시에 같은 일</p>
            </div>
        </section>

        <!-- 2. GPU 스레드 개념 -->
        <section>
            <h2>2. GPU 스레드는 CPU 스레드와 다르다</h2>

            <div class="vs-table">
                <div class="vs-card cpu">
                    <h4>CPU 스레드</h4>
                    <ul>
                        <li>무거운 실행 흐름</li>
                        <li>스택 메모리 할당 (MB 단위)</li>
                        <li>컨텍스트 스위칭 비용 큼</li>
                        <li>OS가 스케줄링</li>
                    </ul>
                </div>
                <div class="vs-card gpu">
                    <h4>GPU 스레드</h4>
                    <ul>
                        <li><strong>"작업 ID"</strong>에 가까움</li>
                        <li>스택 없음, 레지스터만 사용</li>
                        <li>전환 비용 거의 0</li>
                        <li>하드웨어가 스케줄링</li>
                    </ul>
                </div>
            </div>

            <h3>Dispatch와 스레드 생성</h3>

            <div class="code-block"><span class="comment">// C++ 코드</span>
context-><span class="function">Dispatch</span>(<span class="number">4000</span>, <span class="number">1</span>, <span class="number">1</span>);  <span class="comment">// 4000개 그룹 실행</span>

<span class="comment">// HLSL 쉐이더</span>
[<span class="function">numthreads</span>(<span class="number">256</span>, <span class="number">1</span>, <span class="number">1</span>)]  <span class="comment">// 한 그룹당 256개 스레드</span>
<span class="keyword">void</span> <span class="function">CSMain</span>(<span class="type">uint3</span> id : SV_DispatchThreadID) { }

<span class="comment">// 결과: 4000 × 256 = 1,024,000개 작업</span></div>

            <div class="concept-box key">
                <h4>핵심</h4>
                <p>GPU 스레드 100만 개 = <strong>"작업 100만 개 처리해줘"</strong>라는 요청</p>
                <p>실제로는 코어 4000개가 100만 개 작업을 나눠서 처리</p>
            </div>
        </section>

        <!-- 3. Warp -->
        <section>
            <h2>3. Warp (워프) - 실행의 기본 단위</h2>

            <p>GPU는 스레드를 <span class="highlight">32개씩 묶어서</span> 실행합니다. 이 단위를 <strong>Warp</strong>라고 합니다.</p>

            <div class="diagram">1024개 스레드 = 32개 Warp (1024 ÷ 32)

Warp 0:  스레드 0~31
Warp 1:  스레드 32~63
Warp 2:  스레드 64~95
...
Warp 31: 스레드 992~1023</div>

            <h3>SIMT (Single Instruction, Multiple Threads)</h3>

            <p>Warp 내 32개 스레드는 <strong>같은 명령어</strong>를 동시에 실행합니다.</p>

            <div class="diagram">Warp (32개 스레드)
┌─────────────────────────────────────┐
│ 명령어: position += velocity        │  ← 한 번만 Fetch/Decode
├─────────────────────────────────────┤
│ 스레드0:  particle[0] += vel[0]     │
│ 스레드1:  particle[1] += vel[1]     │  ← 32개가 동시에
│ ...                                 │     같은 연산 수행
│ 스레드31: particle[31] += vel[31]   │     (데이터만 다름)
└─────────────────────────────────────┘</div>

            <div class="concept-box">
                <h4>왜 32개씩 묶나?</h4>
                <ul style="margin-left: 20px;">
                    <li>스레드마다 명령어 Fetch/Decode하면 → 하드웨어 비용 폭발</li>
                    <li>32개 묶어서 한 번만 Fetch/Decode → 하드웨어 효율적</li>
                </ul>
            </div>
        </section>

        <!-- 4. Warp Divergence -->
        <section>
            <h2>4. Warp Divergence (워프 분기)</h2>

            <p>Warp 내에서 <strong>if문으로 분기가 갈리면</strong> 성능 문제가 발생합니다.</p>

            <div class="code-block"><span class="keyword">if</span> (particle.y < <span class="number">0</span>) {
    <span class="comment">// 바닥 충돌 처리</span>
} <span class="keyword">else</span> {
    <span class="comment">// 일반 이동</span>
}</div>

            <h3>32개 중 일부만 if, 일부는 else라면?</h3>

            <div class="diagram">Warp를 쪼개는 게 아니라, 둘 다 실행하고 일부를 비활성화

                  if (y < 0)        else
스레드 0~9:       [  실행  ]        [ 대기 ]
스레드 10~31:     [  대기  ]        [ 실행 ]
                  ──────────────────────────→ 시간

결과: 두 경로를 "순차적"으로 실행
→ 최악의 경우 성능 절반</div>

            <div class="concept-box warning">
                <h4>쉐이더에서 if문을 피하라는 이유</h4>
                <p>Warp Divergence가 발생하면 병렬 처리 효율이 떨어집니다.</p>
                <p>단, <strong>Warp 간 분기는 상관없음</strong> - Warp A 전체가 if, Warp B 전체가 else면 문제 없음</p>
            </div>

            <h3>Divergence 피하는 방법</h3>

            <div class="code-block"><span class="comment">// 나쁜 예 - Warp Divergence 발생</span>
<span class="keyword">if</span> (particle.y < <span class="number">0</span>) {
    velocity.y *= -<span class="number">0.8</span>;
}

<span class="comment">// 좋은 예 - 분기 없이 수학으로 처리</span>
<span class="type">float</span> bounce = <span class="function">step</span>(<span class="number">0</span>, -particle.y);  <span class="comment">// y < 0이면 1, 아니면 0</span>
velocity.y = <span class="function">lerp</span>(velocity.y, velocity.y * -<span class="number">0.8</span>, bounce);</div>
        </section>

        <!-- 5. GPU 메모리 -->
        <section>
            <h2>5. GPU 메모리 구조</h2>

            <p>CPU와 GPU는 <strong>메모리가 분리</strong>되어 있습니다.</p>

            <div class="diagram">┌─────────────┐              ┌─────────────┐
│     CPU     │              │     GPU     │
│  ┌───────┐  │              │  ┌───────┐  │
│  │ RAM   │  │◄─── PCIe ───►│  │ VRAM  │  │
│  │(16GB) │  │    버스      │  │(8GB)  │  │
│  └───────┘  │   (느림!)    │  └───────┘  │
└─────────────┘              └─────────────┘</div>

            <h3>데이터 복사 비용</h3>

            <div class="code-block"><span class="comment">// 1. CPU에서 데이터 생성</span>
std::vector&lt;Particle&gt; particles(<span class="number">1000000</span>);

<span class="comment">// 2. GPU로 복사 (느림!)</span>
<span class="function">CreateBuffer</span>(...);
context-><span class="function">UpdateSubresource</span>(...);  <span class="comment">// CPU → GPU</span>

<span class="comment">// 3. GPU에서 연산 (빠름!)</span>
context-><span class="function">Dispatch</span>(<span class="number">4000</span>, <span class="number">1</span>, <span class="number">1</span>);

<span class="comment">// 4. 결과를 CPU로? (느림!)</span>
context-><span class="function">CopyResource</span>(...);  <span class="comment">// GPU → CPU</span></div>

            <div class="concept-box key">
                <h4>파티클 시스템이 빠른 이유</h4>
                <div class="diagram" style="margin: 12px 0;">┌─────────────────────────────────────┐
│               GPU                   │
│  Compute Shader ──► Vertex Shader   │
│    (업데이트)        (렌더링)       │
│         │               │           │
│         └──── VRAM ─────┘           │
│           (데이터 공유)             │
└─────────────────────────────────────┘

데이터가 GPU 밖으로 안 나감 → 복사 비용 없음!</div>
            </div>
        </section>

        <!-- 6. 최종 정리 -->
        <section>
            <h2>6. 핵심 요약</h2>

            <div class="summary-table">
                <table>
                    <tr>
                        <th>개념</th>
                        <th>핵심 내용</th>
                    </tr>
                    <tr>
                        <td>GPU vs CPU</td>
                        <td>코어 수천 개, 단순 연산 병렬 처리 특화</td>
                    </tr>
                    <tr>
                        <td>GPU 스레드</td>
                        <td>CPU 스레드와 다름, "작업 ID" 개념</td>
                    </tr>
                    <tr>
                        <td>Warp (32개)</td>
                        <td>같은 명령어 동시 실행 (SIMT)</td>
                    </tr>
                    <tr>
                        <td>Warp Divergence</td>
                        <td>if 분기 시 성능 저하, 수학으로 대체</td>
                    </tr>
                    <tr>
                        <td>Dispatch</td>
                        <td>그룹 × 스레드 = 총 작업 수</td>
                    </tr>
                    <tr>
                        <td>GPU 메모리</td>
                        <td>CPU와 분리, 복사 비용 큼</td>
                    </tr>
                </table>
            </div>

            <div class="concept-box key" style="margin-top: 24px;">
                <h4>게임 개발자 관점</h4>
                <ul style="margin-left: 20px;">
                    <li><strong>GPU에서 다 처리</strong>: CPU↔GPU 복사 최소화</li>
                    <li><strong>분기 최소화</strong>: if문 대신 수학 함수 사용</li>
                    <li><strong>대량 병렬 작업에 적합</strong>: 파티클, 물리, 후처리 등</li>
                </ul>
            </div>
        </section>

        <div class="nav-links">
            <a href="../category-gpu/">← GPU / 그래픽스 목록</a>
            <a href="../../">메인으로 →</a>
        </div>
    </div>
</body>
</html>
