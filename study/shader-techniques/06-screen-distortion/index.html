<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screen Distortion (화면 왜곡) - MSH Portfolio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #fafafa;
            color: #333;
            line-height: 1.8;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 60px 20px;
        }

        .nav {
            margin-bottom: 40px;
        }

        .nav a {
            color: #666;
            text-decoration: none;
            font-size: 0.9rem;
            margin-right: 12px;
        }

        .nav a:hover {
            color: #333;
        }

        .header {
            margin-bottom: 50px;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: #111;
        }

        .header-meta {
            display: flex;
            gap: 20px;
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .header-meta span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .tag {
            background: #00BCD4;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .section {
            margin-bottom: 50px;
        }

        .section h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #111;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .section h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 30px 0 15px 0;
            color: #333;
        }

        .section p {
            margin-bottom: 16px;
            color: #444;
        }

        .section ul, .section ol {
            margin-left: 20px;
            margin-bottom: 16px;
        }

        .section li {
            margin-bottom: 8px;
            color: #444;
        }

        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            color: #00838f;
        }

        pre code {
            background: none;
            padding: 0;
            color: #d4d4d4;
        }

        .img-container {
            margin: 30px 0;
            text-align: center;
        }

        .img-container img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .img-caption {
            margin-top: 12px;
            font-size: 0.85rem;
            color: #666;
        }

        .highlight-box {
            background: #e0f7fa;
            border-left: 4px solid #00BCD4;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .highlight-box h4 {
            color: #00838f;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .formula-box {
            background: white;
            border: 2px solid #00BCD4;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            text-align: center;
        }

        .formula {
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 1.2rem;
            color: #00838f;
            margin: 10px 0;
        }

        .question-box {
            background: #fff3e0;
            border-left: 4px solid #FF9800;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .question-box h4 {
            color: #e65100;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .answer-box {
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .answer-box h4 {
            color: #2e7d32;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .qa-flow {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .qa-flow .q {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #FF9800;
        }

        .qa-flow .a {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 3px solid #4CAF50;
        }

        .qa-flow .q::before {
            content: "Q. ";
            font-weight: bold;
            color: #e65100;
        }

        .qa-flow .a::before {
            content: "A. ";
            font-weight: bold;
            color: #2e7d32;
        }

        .param-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .param-table th,
        .param-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        .param-table th {
            background: #00BCD4;
            color: white;
            font-weight: 600;
        }

        .param-table tr:last-child td {
            border-bottom: none;
        }

        .footer-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 60px;
            padding-top: 24px;
            border-top: 1px solid #e0e0e0;
        }

        .footer-nav a {
            color: #00BCD4;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .footer-nav a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <a href="../../../">&larr; 메인</a>
            <a href="../">&larr; 쉐이더 테크닉 목록</a>
        </nav>

        <header class="header">
            <h1>06. Screen Distortion (화면 왜곡)</h1>
            <div class="header-meta">
                <span>작성일: 2025-01-13</span>
                <span>구현 완료</span>
                <span>난이도: ★★☆</span>
            </div>
            <div class="tags">
                <span class="tag">DirectX 11</span>
                <span class="tag">HLSL</span>
                <span class="tag">Post-Processing</span>
                <span class="tag">Render Target</span>
                <span class="tag">Noise</span>
            </div>
        </header>

        <!-- 미리보기 이미지 -->
        <div class="img-container">
            <img src="../../../Screenshots/화면왜곡/step4.gif" alt="Screen Distortion 최종 결과" onerror="this.style.display='none'">
            <p class="img-caption">Screen Distortion - 술 취한 효과 (색수차 포함)</p>
        </div>

        <!-- 개요: 질문으로 시작 -->
        <section class="section">
            <h2>화면 왜곡, 어디서 봤나요?</h2>

            <div class="qa-flow">
                <div class="q">게임에서 캐릭터가 독에 중독되거나, 술에 취했을 때 화면이 어떻게 변하나요?</div>
                <div class="a">화면이 흔들리거나 일그러지죠!</div>
            </div>

            <p>
                맞아요. 화면이 <strong>울렁울렁</strong> 흔들리면서 어지러운 느낌을 주는 효과예요.
                이런 효과는 게임에서 자주 쓰여요:
            </p>
            <ul>
                <li><strong>중독/술 취함</strong>: 독 상태, 술 마신 후 효과</li>
                <li><strong>피격/대미지</strong>: 강한 타격을 받았을 때</li>
                <li><strong>환각/혼란</strong>: 정신 상태 이상</li>
                <li><strong>열기/아지랑이</strong>: 사막이나 불 근처</li>
            </ul>
        </section>

        <!-- 핵심 원리 이해 -->
        <section class="section">
            <h2>원리 이해: 픽셀을 밀면?</h2>

            <div class="qa-flow">
                <div class="q">실제로 화면(모니터)이 물리적으로 흔들리는 건 아니잖아요. 그럼 게임은 어떻게 "흔들리는 것처럼" 보이게 만들까요?</div>
                <div class="a">픽셀이 파도치듯 움직이면 되지 않을까요? 울렁이게 뭉개지고 흐려지고...</div>
            </div>

            <p>정확해요! <strong>"픽셀을 이동시키는 것"</strong>이 핵심이에요.</p>

            <div class="qa-flow">
                <div class="q">화면 한가운데 있는 빨간 점이 있다고 해봐요. 이 빨간 점을 오른쪽으로 10픽셀 밀면 화면에 어떻게 보일까요?</div>
                <div class="a">점이 오른쪽으로 이동한 것처럼 보이겠죠!</div>
            </div>

            <div class="qa-flow">
                <div class="q">그럼 빨간 점 하나가 아니라, 화면의 <strong>"모든 픽셀"</strong>을 조금씩 다른 방향으로 밀면 어떻게 보일까요?</div>
                <div class="a">완전히 다른 이미지가 되진 않겠지만... 난시처럼 뿌옇게, 어지러운 느낌이 들 것 같아요!</div>
            </div>

            <div class="highlight-box">
                <h4>핵심 발견!</h4>
                <p><strong>모든 픽셀을 조금씩 다른 방향으로 밀면 = 화면이 왜곡되어 보인다!</strong></p>
            </div>
        </section>

        <!-- 노이즈 개념 -->
        <section class="section">
            <h2>노이즈: 랜덤한 값 만들기</h2>

            <div class="qa-flow">
                <div class="q">"어떤 픽셀은 왼쪽, 어떤 픽셀은 오른쪽"으로 밀려면, 컴퓨터가 각 픽셀마다 "얼마나, 어느 방향으로 밀지"를 알아야 하잖아요. 이걸 어떻게 정할까요?</div>
                <div class="a">랜덤한 값을 사용하면 될 것 같아요. 시드(seed) 같은 걸로?</div>
            </div>

            <p>가까워요! 쉐이더에서는 이런 불규칙한 값을 만들 때 <strong>"노이즈(Noise)"</strong>라는 걸 써요.</p>

            <p>TV 지지직거릴 때 나오는 화면처럼, 흰색/검은색/회색이 막 섞여있는 이미지를 떠올려보세요.</p>

            <div class="qa-flow">
                <div class="q">노이즈 이미지에서 검은색, 흰색, 회색을 숫자로 바꾸면?</div>
                <div class="a">검은색은 0, 흰색은 1, 회색은 0.5 같은 값이 되겠네요!</div>
            </div>

            <div class="highlight-box">
                <h4>노이즈 = 픽셀마다 다른 0~1 사이의 랜덤한 값</h4>
                <ul>
                    <li>검은색 = 0</li>
                    <li>회색 = 0.5</li>
                    <li>흰색 = 1</li>
                </ul>
            </div>
        </section>

        <!-- 공식 조합 -->
        <section class="section">
            <h2>퍼즐 조각 맞추기</h2>

            <div class="qa-flow">
                <div class="q">노이즈 값을 이용해서 픽셀을 밀면 어떤 일이 벌어질까요? 노이즈가 0.1인 픽셀 vs 노이즈가 0.9인 픽셀은?</div>
                <div class="a">0.1만큼 밀리는 픽셀과 0.9만큼 밀리는 픽셀... 0.9가 훨씬 더 많이 밀리니까 왜곡이 심해지겠네요!</div>
            </div>

            <p>맞아요! 노이즈 값이 클수록 많이 밀리고, 작으면 조금 밀려요.</p>

            <div class="qa-flow">
                <div class="q">근데 노이즈 값이 0.9면 픽셀이 화면의 90%나 이동하는 거예요. 너무 심하지 않나요?</div>
                <div class="a">그러면 "전체적으로 얼마나 왜곡할지" 조절하는 값이 필요하겠네요!</div>
            </div>

            <p>그게 바로 <code>amount</code>예요. 만약 <code>amount = 0.01</code>이면?</p>

            <div class="qa-flow">
                <div class="q"><code>noise = 0.9</code>, <code>amount = 0.01</code>일 때 실제 이동량은?</div>
                <div class="a"><code>0.9 × 0.01 = 0.009</code>... 아주 살짝만 밀리네요!</div>
            </div>

            <div class="formula-box">
                <p><strong>화면 왜곡 핵심 공식</strong></p>
                <div class="formula">UV += noise * amount</div>
            </div>

            <ul>
                <li><strong>UV</strong>: 픽셀의 위치 (텍스처 좌표)</li>
                <li><strong>noise</strong>: 픽셀마다 다른 랜덤값 (0~1)</li>
                <li><strong>amount</strong>: 전체 왜곡 강도 조절</li>
            </ul>
        </section>

        <!-- 애니메이션 추가 -->
        <section class="section">
            <h2>울렁울렁 움직이게 만들기</h2>

            <div class="qa-flow">
                <div class="q">술 취한 효과처럼 <strong>시간에 따라 울렁울렁</strong> 하게 만들려면, 이 공식에 뭘 추가해야 할까요?</div>
                <div class="a">시간 값을 이용하거나 sin 함수 같은 걸 써야 하지 않을까요?</div>
            </div>

            <p>둘 다 정답이에요!</p>

            <div class="formula-box">
                <p><strong>애니메이션이 있는 화면 왜곡 공식</strong></p>
                <div class="formula">UV += noise * amount * sin(time)</div>
            </div>

            <ul>
                <li><strong>noise</strong>: 픽셀마다 다르게 밀기</li>
                <li><strong>amount</strong>: 얼마나 세게 밀지</li>
                <li><strong>sin(time)</strong>: 시간에 따라 왔다갔다 (울렁울렁)</li>
            </ul>
        </section>

        <!-- 포스트 프로세싱 개념 -->
        <section class="section">
            <h2>포스트 프로세싱이란?</h2>

            <div class="qa-flow">
                <div class="q">화면 왜곡은 "이미 그려진 화면"을 왜곡하는 거잖아요. 물체 하나하나에 적용하는 게 아니라 화면 전체에 적용하는 건데... 이건 어떤 종류의 쉐이더일까요?</div>
                <div class="a">픽셀 쉐이더? 아, 사진 찍은 "후"에 필터 씌우는 것과 비슷하니까... <strong>포스트 프로세싱</strong>이구나!</div>
            </div>

            <div class="highlight-box">
                <h4>포스트 프로세싱 (Post-Processing)</h4>
                <p>모든 물체를 다 그린 <strong>"후에"</strong> 화면 전체에 효과를 적용하는 기법</p>
            </div>

            <h3>포스트 프로세싱의 흐름</h3>
            <ol>
                <li>모든 물체를 다 그린다 (캐릭터, 배경, UI 등)</li>
                <li>완성된 화면을 <strong>텍스처로 저장</strong>한다 (렌더 타겟)</li>
                <li>그 텍스처의 UV를 노이즈로 흔들어서 다시 그린다 → 왜곡!</li>
            </ol>

            <div class="qa-flow">
                <div class="q">DirectX에서 "완성된 화면을 텍스처로 저장"하려면 뭘 써야 할까요?</div>
                <div class="a"><strong>렌더 타겟(Render Target)</strong>이죠!</div>
            </div>
        </section>

        <!-- 단계별 구현 -->
        <section class="section">
            <h2>단계별 구현 과정</h2>

            <h3>Step 1: 원본 화면</h3>
            <div class="img-container">
                <img src="../../../Screenshots/화면왜곡/step1.gif" alt="Step 1: 원본" onerror="this.style.display='none'">
                <p class="img-caption">Step 1: 포스트 프로세싱 파이프라인 확인 - 왜곡 없이 원본 출력</p>
            </div>
            <p><strong>목적</strong>: 렌더 타겟 → 풀스크린 쿼드로 출력하는 파이프라인이 제대로 작동하는지 확인</p>
            <pre><code>// 픽셀 쉐이더 - 원본 그대로 출력
float4 main(PS_IN input) : SV_Target {
    return SceneTexture.Sample(Sampler, input.UV);
}</code></pre>

            <h3>Step 2: 정적 왜곡</h3>
            <div class="img-container">
                <img src="../../../Screenshots/화면왜곡/step2.gif" alt="Step 2: 정적 왜곡" onerror="this.style.display='none'">
                <p class="img-caption">Step 2: 노이즈로 UV 왜곡 - 찌그러진 화면</p>
            </div>
            <p><strong>목적</strong>: 노이즈 텍스처로 UV를 흔들어 왜곡 효과 확인</p>
            <pre><code>// 픽셀 쉐이더 - 정적 왜곡
float4 main(PS_IN input) : SV_Target {
    // 노이즈 값 가져오기 (0~1)
    float noise = NoiseTexture.Sample(SamplerWrap, input.UV * 5.0).r;

    // 노이즈를 -1~1로 변환 (양방향 이동을 위해)
    noise = noise * 2.0 - 1.0;

    // UV 왜곡
    float2 distortedUV = input.UV + noise * DistortionAmount;

    return SceneTexture.Sample(Sampler, distortedUV);
}</code></pre>

            <h3>Step 3: 애니메이션 왜곡</h3>
            <div class="img-container">
                <img src="../../../Screenshots/화면왜곡/step3.gif" alt="Step 3: 애니메이션" onerror="this.style.display='none'">
                <p class="img-caption">Step 3: sin(time) 추가 - 울렁울렁 효과</p>
            </div>
            <p><strong>목적</strong>: 시간에 따라 왜곡이 변하는 애니메이션 효과</p>
            <pre><code>// 픽셀 쉐이더 - 애니메이션 왜곡
float4 main(PS_IN input) : SV_Target {
    // 노이즈 UV를 시간에 따라 움직임
    float2 noiseUV = input.UV * 5.0 + Time * 0.5;
    float noise = NoiseTexture.Sample(SamplerWrap, noiseUV).r;
    noise = noise * 2.0 - 1.0;

    // sin(time)으로 왜곡 강도 변화
    float wave = sin(Time * 3.0) * 0.5 + 0.5;

    float2 distortedUV = input.UV + noise * DistortionAmount * wave;

    return SceneTexture.Sample(Sampler, distortedUV);
}</code></pre>

            <h3>Step 4: 술 취한 효과 (색수차)</h3>
            <div class="img-container">
                <img src="../../../Screenshots/화면왜곡/step4.gif" alt="Step 4: 술 취한 효과" onerror="this.style.display='none'">
                <p class="img-caption">Step 4: 색수차(Chromatic Aberration) 추가 - RGB가 분리되는 효과</p>
            </div>
            <p><strong>목적</strong>: RGB 채널을 살짝 다른 위치에서 샘플링해서 더 취한 느낌</p>
            <pre><code>// 픽셀 쉐이더 - 술 취한 효과 + 색수차
float4 main(PS_IN input) : SV_Target {
    float2 noiseUV = input.UV * 5.0 + Time * 0.3;
    float noise = NoiseTexture.Sample(SamplerWrap, noiseUV).r;
    noise = noise * 2.0 - 1.0;

    // 다중 sin 파동으로 더 복잡한 울렁임
    float wave1 = sin(Time * 2.0);
    float wave2 = sin(Time * 3.5 + 1.0) * 0.5;
    float wave = (wave1 + wave2) * 0.5 + 0.5;

    float2 offset;
    offset.x = noise * DistortionAmount * wave;
    offset.y = noise * DistortionAmount * wave * 0.7;

    float2 distortedUV = input.UV + offset;

    // 색수차 효과 - RGB를 다른 위치에서 샘플링
    float3 color;
    color.r = SceneTexture.Sample(Sampler, distortedUV + float2(0.002, 0) * DistortionAmount * 10).r;
    color.g = SceneTexture.Sample(Sampler, distortedUV).g;
    color.b = SceneTexture.Sample(Sampler, distortedUV - float2(0.002, 0) * DistortionAmount * 10).b;

    return float4(color, 1);
}</code></pre>
        </section>

        <!-- 파라미터 -->
        <section class="section">
            <h2>파라미터 조정</h2>

            <table class="param-table">
                <thead>
                    <tr>
                        <th>파라미터</th>
                        <th>설명</th>
                        <th>권장 범위</th>
                        <th>효과</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>DistortionAmount</strong></td>
                        <td>왜곡 강도</td>
                        <td>0.01 ~ 0.05</td>
                        <td>높을수록 심한 왜곡</td>
                    </tr>
                    <tr>
                        <td><strong>Time</strong></td>
                        <td>애니메이션 시간</td>
                        <td>계속 증가</td>
                        <td>울렁임 속도 조절</td>
                    </tr>
                    <tr>
                        <td><strong>NoiseScale</strong></td>
                        <td>노이즈 타일링</td>
                        <td>3.0 ~ 10.0</td>
                        <td>왜곡 패턴 세밀함</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- 핵심 정리 -->
        <section class="section">
            <h2>핵심 정리</h2>

            <div class="highlight-box">
                <h4>화면 왜곡의 핵심</h4>
                <ul>
                    <li><strong>포스트 프로세싱</strong>: 모든 걸 그린 후 화면 전체에 효과 적용</li>
                    <li><strong>렌더 타겟</strong>: 화면을 텍스처로 저장</li>
                    <li><strong>노이즈</strong>: 픽셀마다 다른 랜덤값</li>
                    <li><strong>UV 왜곡</strong>: <code>UV += noise * amount</code></li>
                    <li><strong>애니메이션</strong>: <code>sin(time)</code>으로 울렁울렁</li>
                </ul>
            </div>

            <h3>화면 왜곡이 쓰이는 곳</h3>
            <ul>
                <li><strong>상태 이상</strong>: 중독, 술 취함, 혼란</li>
                <li><strong>피격 효과</strong>: 강한 타격, 폭발</li>
                <li><strong>환경 효과</strong>: 열기, 물속, 환각</li>
                <li><strong>전환 효과</strong>: 씬 전환, 타임워프</li>
            </ul>
        </section>

        <footer class="footer-nav">
            <a href="../05-outline/">&larr; 05. Outline</a>
            <a href="../">쉐이더 테크닉 목록 &rarr;</a>
        </footer>
    </div>
</body>
</html>
