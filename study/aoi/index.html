<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AOI (Area of Interest) - MSH Portfolio</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #fafafa;
            color: #333;
            line-height: 1.9;
        }
        .container { max-width: 800px; margin: 0 auto; padding: 60px 20px; }
        .back-link {
            display: inline-block;
            margin-bottom: 24px;
            color: #666;
            text-decoration: none;
        }
        .back-link:hover { color: #111; }
        .header { margin-bottom: 48px; }
        .header h1 { font-size: 2rem; font-weight: 700; color: #111; margin-bottom: 12px; }
        .header p { color: #666; font-size: 1.1rem; }

        /* 대화 스타일 */
        .conversation {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin: 32px 0;
            border: 1px solid #e0e0e0;
        }
        .conversation h2 {
            font-size: 1.3rem;
            color: #1a237e;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e8eaf6;
        }

        .chat { margin-bottom: 20px; }
        .q {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 16px 20px;
            margin: 16px 0;
            border-radius: 0 12px 12px 0;
            font-weight: 500;
        }
        .q::before {
            content: "Q. ";
            color: #e65100;
            font-weight: 700;
        }
        .a {
            padding: 8px 0 8px 20px;
            border-left: 4px solid #e0e0e0;
            margin: 12px 0;
        }
        .a p { margin-bottom: 12px; }
        .a p:last-child { margin-bottom: 0; }

        .highlight {
            background: #e3f2fd;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: #1565c0;
        }
        .key-point {
            background: #c8e6c9;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: #2e7d32;
        }
        .warning {
            background: #ffcdd2;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: #c62828;
        }

        /* GIF 섹션 */
        .visual-section {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .visual-section h4 {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 12px;
        }
        .step-gif {
            width: 100%;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        .gif-caption {
            font-size: 0.85rem;
            color: #666;
            margin-top: 8px;
            text-align: center;
        }

        /* 코드 블록 */
        .code-block {
            background: #263238;
            border-radius: 8px;
            padding: 16px 20px;
            margin: 16px 0;
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
            color: #eceff1;
            overflow-x: auto;
            line-height: 1.6;
        }

        /* 비교 테이블 */
        .compare-table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 0.9rem;
        }
        .compare-table th, .compare-table td {
            padding: 12px;
            border: 1px solid #e0e0e0;
            text-align: left;
        }
        .compare-table th {
            background: #f5f5f5;
            font-weight: 600;
        }

        /* 핵심 정리 박스 */
        .summary-box {
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            border-radius: 16px;
            padding: 32px;
            color: white;
            margin: 32px 0;
        }
        .summary-box h3 {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        .summary-box ul {
            list-style: none;
        }
        .summary-box li {
            padding: 8px 0;
            padding-left: 24px;
            position: relative;
        }
        .summary-box li::before {
            content: "→";
            position: absolute;
            left: 0;
            color: #90caf9;
        }

        .divider {
            height: 1px;
            background: #e0e0e0;
            margin: 32px 0;
        }

        .nav-links {
            display: flex;
            justify-content: space-between;
            margin-top: 60px;
            padding-top: 24px;
            border-top: 1px solid #e0e0e0;
        }
        .nav-links a {
            color: #1a237e;
            text-decoration: none;
        }
        .nav-links a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../network/" class="back-link">← 네트워크</a>

        <header class="header">
            <h1>AOI (Area of Interest)</h1>
            <p>관심 영역 - 내 주변만 동기화하는 기술</p>
        </header>

        <!-- Part 1: 왜 필요한가 -->
        <div class="conversation">
            <h2>Part 1. 왜 AOI가 필요할까?</h2>

            <div class="chat">
                <div class="q">MMO에서 내가 서울에 있는데, 부산에 있는 유저 정보까지 받아야 해?</div>
                <div class="a">
                    <p><strong>필요 없지.</strong> 어차피 안 보이는데 왜 받아?</p>
                    <p>그래서 나온 개념이 <span class="highlight">AOI (Area of Interest)</span> = 관심 영역</p>
                    <p><span class="key-point">내 주변 일정 반경 안에 있는 것만 동기화</span>하자는 거야.</p>
                </div>
            </div>

            <div class="visual-section">
                <h4>시뮬레이션: AOI 없이 모든 유저 연결 (N² 문제)</h4>
                <img src="./images/step1.gif" alt="Step 1: N² Problem" class="step-gif">
                <p class="gif-caption">30명만 있어도 빨간 선이 난장판 = 모든 유저 정보를 다 받으면 이렇게 됨</p>
            </div>

            <div class="chat">
                <div class="q">그러면 "일정 반경"이 얼마나 되는 거야? 누가 정해?</div>
                <div class="a">
                    <p><span class="highlight">서버가 정해.</span> 보통 게임 기획 단계에서 고정값으로 정함.</p>
                    <p>예를 들어:</p>
                    <p>• MMO RPG: 반경 50m</p>
                    <p>• 배틀로얄: 반경 200m</p>
                    <p>• 레이싱: 반경 500m</p>
                </div>
            </div>

            <div class="code-block">
유저 A 위치: (100, 200)
AOI 반경: 50m

→ (100, 200) 중심으로 50m 안에 있는 유저만 찾아서
→ A한테 그 유저들 정보만 보내줌
            </div>

            <div class="visual-section">
                <h4>시뮬레이션: AOI 적용 후</h4>
                <img src="./images/step2.gif" alt="Step 2: AOI Applied" class="step-gif">
                <p class="gif-caption">파란 원(AOI) 안에 있는 유저만 초록색 + 연결선. 밖은 회색.</p>
            </div>
        </div>

        <!-- Part 2: 성능 문제 -->
        <div class="conversation">
            <h2>Part 2. 근데 이거 느리지 않아?</h2>

            <div class="chat">
                <div class="q">유저가 1만 명이야. 매번 "나한테서 50m 안에 누가 있지?" 계산하면 엄청 느리지 않아?</div>
                <div class="a">
                    <p><span class="warning">맞아, 느려.</span></p>
                    <p>1만 명 전부 거리 계산하면? <strong>O(N²)</strong> = 죽음</p>
                </div>
            </div>

            <div class="chat">
                <div class="q">어떻게 해결해?</div>
                <div class="a">
                    <p><span class="key-point">공간을 미리 격자(Grid)로 나눠놓기</span></p>
                </div>
            </div>

            <div class="code-block">
┌───┬───┬───┬───┐
│ 1 │ 2 │ 3 │ 4 │
├───┼───┼───┼───┤
│ 5 │ 6 │ 7 │ 8 │
├───┼───┼───┼───┤
│ 9 │10 │11 │12 │
└───┴───┴───┴───┘

각 칸 = 50m × 50m
            </div>

            <div class="chat">
                <div class="a">
                    <p><strong>유저가 움직이면:</strong></p>
                    <p>• "나 지금 6번 칸에 있어"</p>
                    <p>• 서버: "6번 칸 + 주변 8칸(1,2,3,5,7,9,10,11)만 확인하면 됨"</p>
                    <p><span class="warning">1만 명 전부 확인 ❌</span></p>
                    <p><span class="key-point">내 칸 + 주변 칸만 확인 ✅</span></p>
                </div>
            </div>

            <div class="visual-section">
                <h4>시뮬레이션: Grid 최적화</h4>
                <img src="./images/step3.gif" alt="Step 3: Grid Optimization" class="step-gif">
                <p class="gif-caption">격자가 보이고, 내 칸(파란색) + 주변 칸(연한색)만 하이라이트</p>
            </div>
        </div>

        <!-- Part 3: Zone과의 차이 -->
        <div class="conversation">
            <h2>Part 3. 이거 Zone이랑 뭐가 달라?</h2>

            <div class="chat">
                <div class="q">아까 배운 Zone이랑 뭐가 달라? 똑같이 칸 나누는 거 아니야?</div>
                <div class="a">
                    <p><strong>핵심 차이가 있어.</strong></p>
                </div>
            </div>

            <table class="compare-table">
                <tr>
                    <th></th>
                    <th>Zone 기반</th>
                    <th>AOI Grid</th>
                </tr>
                <tr>
                    <td><strong>칸의 의미</strong></td>
                    <td>서버 경계 (다른 프로세스)</td>
                    <td>검색용 자료구조 (같은 프로세스)</td>
                </tr>
                <tr>
                    <td><strong>칸 넘을 때</strong></td>
                    <td>핸드오프 필요, 복잡함</td>
                    <td>아무 일 없음</td>
                </tr>
                <tr>
                    <td><strong>목적</strong></td>
                    <td>서버 부하 분산</td>
                    <td>빠른 검색</td>
                </tr>
                <tr>
                    <td><strong>비유</strong></td>
                    <td>서울시청 vs 부산시청</td>
                    <td>내 책상 서랍 칸</td>
                </tr>
            </table>

            <div class="chat">
                <div class="q">그러면 AOI는 서버 1대로 다 처리하는 건가?</div>
                <div class="a">
                    <p>꼭 그런 건 아니야.</p>
                    <p><span class="highlight">AOI = "뭘 동기화할지"</span> 정하는 개념</p>
                    <p><span class="highlight">Zone = "누가 처리할지"</span> 정하는 개념</p>
                    <p>둘은 <strong>다른 층위의 문제</strong>야. 같이 쓸 수 있어.</p>
                </div>
            </div>

            <div class="code-block">
소규모 (100명 이하)  → 서버 1대 + AOI만
중규모 (1000명)     → 서버 1대 + AOI + 최적화
대규모 (1만명+)     → Zone 여러 대 + 각 서버 안에서 AOI
            </div>
        </div>

        <!-- Part 4: 최적화 -->
        <div class="conversation">
            <h2>Part 4. 더 최적화할 수 있어?</h2>

            <div class="chat">
                <div class="q">유저가 움직일 때마다 AOI 다시 계산해야 하잖아. 그거 너무 자주 하면 부하 아니야?</div>
                <div class="a">
                    <p>맞아. 몇 가지 최적화 방법이 있어.</p>
                </div>
            </div>

            <div class="chat">
                <div class="a">
                    <p><strong>1. 매 프레임마다 계산 ❌ → 일정 주기로 계산 ✅</strong></p>
                    <p>• 매 프레임 (60fps) = 초당 60번 계산 → 죽음</p>
                    <p>• 200ms마다 = 초당 5번 계산 → 괜찮음</p>
                    <p>어차피 사람 눈은 0.2초 차이 잘 못 느껴.</p>
                </div>
            </div>

            <div class="chat">
                <div class="a">
                    <p><strong>2. 움직일 때마다 ❌ → 칸 넘을 때만 ✅</strong></p>
                    <p>유저가 같은 칸 안에서 움직이면 AOI 재계산 안 함.</p>
                    <p>칸 경계를 넘을 때만 재계산.</p>
                </div>
            </div>

            <div class="chat">
                <div class="a">
                    <p><strong>3. 나갔다 들어왔다 반복 방지 (Hysteresis)</strong></p>
                    <p>AOI 경계에서 왔다갔다 하면 상대방이 깜빡깜빡 나타났다 사라짐.</p>
                    <p>해결: 나가도 바로 안 끊고 1~2초 기다림.</p>
                </div>
            </div>

            <div class="visual-section">
                <h4>시뮬레이션: Hysteresis (깜빡임 방지)</h4>
                <img src="./images/step4.gif" alt="Step 4: Hysteresis" class="step-gif">
                <p class="gif-caption">AOI 밖으로 나가도 노란 원(타이머)이 표시되고, 바로 안 끊김</p>
            </div>
        </div>

        <!-- Part 5: 비대칭 문제 -->
        <div class="conversation">
            <h2>Part 5. AOI 크기가 다르면?</h2>

            <div class="chat">
                <div class="q">저격수가 100m 밖 적을 쏘려면 일단 봐야 조준하잖아. 근데 AOI 50m면 안 보이는데 어떻게 쏴?</div>
                <div class="a">
                    <p>좋은 질문이야. 실제로 이렇게 해:</p>
                    <p><span class="key-point">저격 스코프 켜면 → 서버가 "스코프 범위 내 적 위치"만 따로 보내줌</span></p>
                </div>
            </div>

            <div class="code-block">
평소: AOI 50m (주변 유저 전체 정보)

스코프 ON:
→ 서버야, 100m 안에 누구 있어?
→ 서버: "72m에 적 1명 있음" (위치만 알려줌)
→ 클라: 스코프 화면에 점으로 표시
            </div>

            <table class="compare-table">
                <tr>
                    <th></th>
                    <th>AOI 확장</th>
                    <th>스코프 전용 정보</th>
                </tr>
                <tr>
                    <td><strong>받는 정보</strong></td>
                    <td>HP, 장비, 스킬, 버프 전부</td>
                    <td>위치만</td>
                </tr>
                <tr>
                    <td><strong>언제</strong></td>
                    <td>항상</td>
                    <td>스코프 켰을 때만</td>
                </tr>
                <tr>
                    <td><strong>트래픽</strong></td>
                    <td>많음</td>
                    <td>적음</td>
                </tr>
            </table>

            <div class="chat">
                <div class="a">
                    <p>게임에서 본 적 있을걸:</p>
                    <p>• 스코프로 보면 → 멀리 있는 적이 <strong>빨간 점</strong>이나 <strong>실루엣</strong>으로만 보임</p>
                    <p>• 가까이 가면 → 풀 모델로 보임</p>
                    <p>그게 이거야. <span class="highlight">스코프 = 제한된 정보만 받는 것</span></p>
                </div>
            </div>

            <div class="visual-section">
                <h4>시뮬레이션: 스코프 모드</h4>
                <img src="./images/step5.gif" alt="Step 5: Scope Mode" class="step-gif">
                <p class="gif-caption">Space로 스코프 ON → 큰 주황 원 범위 내 먼 적은 작은 빨간 점으로만 보임</p>
            </div>
        </div>

        <!-- Part 6: Zone vs AOI 정리 -->
        <div class="conversation">
            <h2>Part 6. Zone이랑 AOI 언제 뭘 써?</h2>

            <table class="compare-table">
                <tr>
                    <th></th>
                    <th>Zone 기반</th>
                    <th>AOI</th>
                </tr>
                <tr>
                    <td><strong>목적</strong></td>
                    <td>서버 부하 분산</td>
                    <td>동기화 범위 제한</td>
                </tr>
                <tr>
                    <td><strong>단위</strong></td>
                    <td>서버 (프로세스)</td>
                    <td>자료구조 (검색용)</td>
                </tr>
                <tr>
                    <td><strong>경계</strong></td>
                    <td>넘으면 핸드오프</td>
                    <td>넘어도 아무 일 없음</td>
                </tr>
                <tr>
                    <td><strong>쓰는 경우</strong></td>
                    <td>월드가 넓고 유저 많을 때</td>
                    <td>근처 유저만 보면 될 때</td>
                </tr>
            </table>

            <div class="chat">
                <div class="a">
                    <p><strong>핵심: Zone과 AOI는 같이 쓰는 거야.</strong></p>
                    <p>둘 중 하나 고르는 게 아님!</p>
                </div>
            </div>

            <div class="code-block">
[Zone A 서버]          |          [Zone B 서버]
                       |
  ●← 이 유저는            |      ●← 이 유저는
  자기 AOI 50m만 동기화    |      자기 AOI 50m만 동기화

→ Zone으로 서버 나누고
→ 각 서버 안에서 AOI로 동기화 범위 제한
            </div>
        </div>

        <!-- 전체 정리 -->
        <div class="summary-box">
            <h3>전체 정리</h3>
            <ul>
                <li><strong>AOI</strong> = 내 주변 일정 반경만 동기화</li>
                <li><strong>Grid</strong> = 빠른 검색을 위한 공간 분할 (서버 분리 아님)</li>
                <li><strong>Hysteresis</strong> = 경계 깜빡임 방지 (바로 안 끊고 기다림)</li>
                <li><strong>스코프 모드</strong> = AOI 밖은 제한된 정보(위치)만</li>
                <li><strong>Zone + AOI</strong> = 대규모 게임은 둘 다 사용</li>
            </ul>
        </div>

        <div class="nav-links">
            <a href="../network/">← 네트워크</a>
            <a href="../../">메인으로 →</a>
        </div>
    </div>
</body>
</html>
